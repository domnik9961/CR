<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>ReportForge ‚Äî Kreator Definicji CR</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.3/font/bootstrap-icons.min.css" rel="stylesheet"/>
<link rel="stylesheet" href="styles.css"/>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TOPBAR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<nav class="topbar" id="topbar">
  <button class="mobile-menu-btn" id="mobileMenuBtn" onclick="openMobileMenu()"><i class="bi bi-list"></i></button>
  <a class="topbar-brand" href="#">
    <div class="brand-logo"><i class="bi bi-file-earmark-bar-graph"></i></div>
    <span class="brand-text">Report<span>Forge</span></span>
  </a>
  <div class="topbar-center">
    <button class="sidebar-toggle" onclick="toggleSidebar()" title="Poka≈º/ukryj nawigacjƒô">
      <i class="bi bi-layout-sidebar"></i>
    </button>
    <div class="global-progress" title="Postƒôp wype≈Çnienia formularza">
      <div class="global-progress-fill" id="globalProgressFill" style="width:0%"></div>
    </div>
    <span class="progress-label" id="progressLabel">0% gotowe</span>
  </div>
  <div class="topbar-right">
    <div class="theme-switch" role="group" aria-label="Tryb kolorystyczny">
      <button class="theme-switch-btn active" id="themeLightBtn" type="button" onclick="setTheme('light')"><i class="bi bi-sun-fill"></i><span>LIGHT</span></button>
      <button class="theme-switch-btn" id="themeDarkBtn" type="button" onclick="setTheme('dark')"><i class="bi bi-moon-stars-fill"></i><span>DARK MODE</span></button>
      <button class="theme-switch-btn" id="themeAutoBtn" type="button" onclick="setTheme('auto')"><i class="bi bi-circle-half"></i><span>AUTO PLUS</span></button>
    </div>
    <button class="tb-btn" onclick="showToast('Zapisano szkic!','success')"><i class="bi bi-save"></i><span>Zapisz</span></button>
    <button class="tb-btn summary-toggle-btn" id="summaryToggleBtn" data-summary-toggle onclick="toggleSummary()"><i class="bi bi-panel-split"></i><span>Podsumowanie</span></button>
    <button class="tb-btn primary" data-summary-toggle onclick="toggleSummary()"><i class="bi bi-file-earmark-text"></i><span>Generuj dok.</span></button>
  </div>
</nav>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MOBILE OVERLAY ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="mobile-overlay" id="mobileOverlay" onclick="closeMobileMenu()"></div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SHELL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="shell">

  <!-- ‚ïê‚ïê‚ïê SIDEBAR ‚ïê‚ïê‚ïê -->
  <nav class="sidebar" id="sidebar">
    <div class="sidebar-inner" id="sidebarInner">
      <div class="sidebar-section-label">Definicja raportu</div>

      <button class="tab-btn active" data-tab="t1" onclick="switchTab('t1',this)">
        <div class="tab-ico"><i class="bi bi-info-circle"></i></div>
        <span class="tab-label">Informacje og√≥lne</span>
        <span class="tab-status none" id="ts-t1"></span>
      </button>
      <button class="tab-btn" data-tab="t2" onclick="switchTab('t2',this)">
        <div class="tab-ico"><i class="bi bi-database"></i></div>
        <span class="tab-label">≈πr√≥d≈Ço SQL</span>
        <span class="tab-status none" id="ts-t2"></span>
      </button>
      <button class="tab-btn" data-tab="t3" onclick="switchTab('t3',this)">
        <div class="tab-ico"><i class="bi bi-table"></i></div>
        <span class="tab-label">Kolumny</span>
        <span class="tab-status none" id="ts-t3"></span>
      </button>
      <button class="tab-btn" data-tab="t4" onclick="switchTab('t4',this)">
        <div class="tab-ico"><i class="bi bi-sliders"></i></div>
        <span class="tab-label">Parametry</span>
        <span class="tab-status none" id="ts-t4"></span>
      </button>
      <button class="tab-btn" data-tab="t5" onclick="switchTab('t5',this)">
        <div class="tab-ico"><i class="bi bi-funnel"></i></div>
        <span class="tab-label">Filtry</span>
        <span class="tab-status none" id="ts-t5"></span>
      </button>
      <button class="tab-btn" data-tab="t6" onclick="switchTab('t6',this)">
        <div class="tab-ico"><i class="bi bi-collection"></i></div>
        <span class="tab-label">Grupowanie</span>
        <span class="tab-status none" id="ts-t6"></span>
      </button>
      <button class="tab-btn" data-tab="t7" onclick="switchTab('t7',this)">
        <div class="tab-ico"><i class="bi bi-diagram-2"></i></div>
        <span class="tab-label">Podraporty</span>
        <span class="tab-status none" id="ts-t7"></span>
      </button>

      <div class="sidebar-section-label" style="margin-top:8px">Prezentacja</div>

      <button class="tab-btn" data-tab="t8" onclick="switchTab('t8',this)">
        <div class="tab-ico"><i class="bi bi-layout-text-window"></i></div>
        <span class="tab-label">Nag≈Ç√≥wki / Stopki</span>
        <span class="tab-status none" id="ts-t8"></span>
      </button>
      <button class="tab-btn" data-tab="t9" onclick="switchTab('t9',this)">
        <div class="tab-ico"><i class="bi bi-inbox"></i></div>
        <span class="tab-label">Brak danych</span>
        <span class="tab-status none" id="ts-t9"></span>
      </button>
      <button class="tab-btn" data-tab="t10" onclick="switchTab('t10',this)">
        <div class="tab-ico"><i class="bi bi-box-arrow-up-right"></i></div>
        <span class="tab-label">Opcje wyj≈õcia</span>
        <span class="tab-status none" id="ts-t10"></span>
      </button>
    </div>

    <div class="sidebar-footer">
      <button class="sidebar-footer-btn" onclick="showToast('Szkic zapisany!','success')">
        <i class="bi bi-save"></i><span class="tab-label">Zapisz szkic</span>
      </button>
      <button class="sidebar-footer-btn" data-summary-toggle onclick="toggleSummary()">
        <i class="bi bi-eye"></i><span class="tab-label">PodglƒÖd podsumowania</span>
      </button>
    </div>
  </nav>

  <!-- ‚ïê‚ïê‚ïê MAIN ‚ïê‚ïê‚ïê -->
  <main class="main">
    <form id="reportDefinitionForm">
      <div class="quick-actions" aria-label="Szybkie akcje formularza">
        <button class="quick-action-chip lightning" type="button" onclick="clearCurrentSection()"><i class="bi bi-lightning-charge"></i>Wyczy≈õƒá sekcjƒô</button>
        <button class="quick-action-chip warning" type="button" onclick="jumpToErrors()"><i class="bi bi-exclamation-circle"></i>Przejd≈∫ do b≈Çƒôd√≥w</button>
        <button class="quick-action-chip success" type="button" onclick="copySummaryToClipboard()"><i class="bi bi-clipboard-check"></i>Skopiuj podsumowanie</button>
      </div>
      <div class="tab-content">

      <!-- ‚ïê‚ïê TAB 1 ‚ïê‚ïê -->
      <div class="tab-pane active" id="t1">
        <div class="step-indicator"><div class="step-dot"></div>Krok 1 z 10</div>
        <div class="page-header">
          <h1>Informacje og√≥lne</h1>
          <p>Podstawowe metadane identyfikujƒÖce raport w systemie, dokumentacji technicznej i backlogu dewelopera.</p>
        </div>

        <div class="card card-nth-1">
          <div class="card-head collapsible" onclick="toggleCard(this)">
            <div class="card-ico ci-blue"><i class="bi bi-tag"></i></div>
            <span class="card-title">Identyfikacja raportu</span>
            <span class="card-badge badge-req">WYMAGANE</span>
            <i class="bi bi-chevron-down collapse-chevron ms-auto"></i>
          </div>
          <div class="card-body">
            <div class="form-row cols-2">
              <div class="field">
                <label class="field-label">Nazwa raportu <span class="req-star">*</span>
                  <i class="tip-btn">?<span class="tip-popup">Unikalna techniczna nazwa w systemie. U≈ºywana jako identyfikator w C# przy ≈Çadowaniu .rpt. Bez spacji ‚Äî u≈ºyj camelCase lub podkre≈õle≈Ñ.</span></i>
                </label>
                <input type="text" class="fc" id="rName" placeholder="np. RaportSprzedazyMiesiecznej" required minlength="3" pattern="[A-Za-z0-9_]+" title="U≈ºyj tylko liter, cyfr i podkre≈õle≈Ñ (bez spacji)." oninput="onFieldChange(this)"/>
                <div class="field-hint"><i class="bi bi-info-circle"></i>Nazwa pliku .rpt i identyfikator w kodzie</div>
              </div>
              <div class="field">
                <label class="field-label">Tytu≈Ç wy≈õwietlany <span class="req-star">*</span>
                  <i class="tip-btn">?<span class="tip-popup">Tekst widoczny dla u≈ºytkownika na wydruku. Mo≈ºe zawieraƒá tokeny CR np. {?MiesiƒÖc} zastƒôpowane dynamicznie.</span></i>
                </label>
                <input type="text" class="fc" id="rTitle" placeholder="np. RAPORT SPRZEDA≈ªY ‚Äî {?MiesiƒÖc} {?Rok}" required minlength="5" oninput="onFieldChange(this)"/>
              </div>
            </div>
            <div class="form-row cols-3">
              <div class="field">
                <label class="field-label">Wersja <i class="tip-btn">?<span class="tip-popup">Semantyczna wersja raportu (SemVer: MAJOR.MINOR.PATCH). Pozwala ≈õledziƒá historiƒô zmian i robiƒá rollback.</span></i></label>
                <input type="text" class="fc" id="rVersion" placeholder="1.0.0" oninput="onFieldChange(this)"/>
              </div>
              <div class="field">
                <label class="field-label">Status</label>
                <select class="fs" id="rStatus" onchange="onFieldChange(this)">
                  <option>Szkic</option><option>Do weryfikacji</option>
                  <option>Zatwierdzone</option><option>W realizacji</option>
                  <option>Zarchiwizowane</option>
                </select>
              </div>
              <div class="field">
                <label class="field-label">Priorytet <i class="tip-btn">?<span class="tip-popup">Wp≈Çywa na kolejno≈õƒá w backlogu. Krytyczny = blokuje inne procesy i wymaga natychmiastowej realizacji.</span></i></label>
                <select class="fs" id="rPriority" onchange="onFieldChange(this)">
                  <option>‚Äî wybierz ‚Äî</option><option>Krytyczny üî¥</option>
                  <option>Wysoki üü†</option><option>Normalny üü°</option><option>Niski üü¢</option>
                </select>
              </div>
            </div>
            <div class="form-row">
              <div class="field">
                <label class="field-label">Opis / cel raportu <span class="req-star">*</span>
                  <i class="tip-btn">?<span class="tip-popup">Opisz: dla kogo jest raport, jakie decyzje biznesowe wspiera, jakie dane prezentuje i jak czƒôsto jest generowany. Trafi do dokumentacji technicznej.</span></i>
                </label>
                <textarea class="fc" id="rDesc" placeholder="Opisz przeznaczenie raportu, grupƒô docelowƒÖ u≈ºytkownik√≥w, jakie decyzje biznesowe wspiera oraz jak czƒôsto bƒôdzie generowany..." required minlength="20" oninput="onFieldChange(this)"></textarea>
              </div>
            </div>
          </div>
        </div>

        <div class="card card-nth-2">
          <div class="card-head collapsible" onclick="toggleCard(this)">
            <div class="card-ico ci-purple"><i class="bi bi-people"></i></div>
            <span class="card-title">Odpowiedzialno≈õƒá i terminy</span>
            <i class="bi bi-chevron-down collapse-chevron ms-auto"></i>
          </div>
          <div class="card-body">
            <div class="form-row cols-3">
              <div class="field"><label class="field-label">Autor <i class="tip-btn">?<span class="tip-popup">Osoba wype≈ÇniajƒÖca formularz ‚Äî punkt kontaktu przy pytaniach do specyfikacji.</span></i></label><input type="text" class="fc" placeholder="Imiƒô i nazwisko" oninput="onFieldChange(this)"/></div>
              <div class="field"><label class="field-label">W≈Ça≈õciciel biznesowy <i class="tip-btn">?<span class="tip-popup">Dzia≈Ç/osoba zamawiajƒÖca. Odpowiedzialna za akceptacjƒô wymaga≈Ñ i odbi√≥r ko≈Ñcowy raportu.</span></i></label><input type="text" class="fc" placeholder="Dzia≈Ç / email" oninput="onFieldChange(this)"/></div>
              <div class="field"><label class="field-label">Nr ticketu <i class="tip-btn">?<span class="tip-popup">Numer zadania w JIRA/Azure DevOps. Umo≈ºliwia powiƒÖzanie dokumentacji z kodem i ≈õledzenie zmian.</span></i></label><input type="text" class="fc" placeholder="np. PROJ-1234" oninput="onFieldChange(this)"/></div>
            </div>
            <div class="form-row cols-2">
              <div class="field"><label class="field-label">Data zlecenia</label><input type="date" class="fc" oninput="onFieldChange(this)"/></div>
              <div class="field"><label class="field-label">Termin realizacji</label><input type="date" class="fc" oninput="onFieldChange(this)"/></div>
            </div>
            <div class="field"><label class="field-label">Uwagi i ograniczenia <i class="tip-btn">?<span class="tip-popup">Wszystko czego nie obejmujƒÖ pozosta≈Çe pola: ograniczenia wydajno≈õciowe, zale≈ºno≈õci, znane wyjƒÖtki danych, wymagania bezpiecze≈Ñstwa.</span></i></label><textarea class="fc" placeholder="np. Raport max 1√ó/dzie≈Ñ ze wzglƒôdu na wydajno≈õƒá. Dane wra≈ºliwe ‚Äî dostƒôp tylko dla roli MANAGER..." oninput="onFieldChange(this)"></textarea></div>
          </div>
        </div>

        <div class="nav-actions">
          <div></div>
          <button class="btn-primary" onclick="goTab('t2')">Dalej: ≈πr√≥d≈Ço SQL <i class="bi bi-arrow-right"></i></button>
        </div>
      </div>

      <!-- ‚ïê‚ïê TAB 2 ‚ïê‚ïê -->
      <div class="tab-pane" id="t2">
        <div class="step-indicator"><div class="step-dot"></div>Krok 2 z 10</div>
        <div class="page-header"><h1>≈πr√≥d≈Ço danych (SQL)</h1><p>Zdefiniuj skƒÖd Crystal Reports pobiera dane ‚Äî widok, procedura sk≈Çadowana lub zapytanie inline.</p></div>

        <div class="card card-nth-1">
          <div class="card-head collapsible" onclick="toggleCard(this)">
            <div class="card-ico ci-blue"><i class="bi bi-database"></i></div>
            <span class="card-title">Konfiguracja po≈ÇƒÖczenia</span>
            <span class="card-badge badge-req">WYMAGANE</span>
            <i class="bi bi-chevron-down collapse-chevron ms-auto"></i>
          </div>
          <div class="card-body">
            <div class="form-row cols-3">
              <div class="field">
                <label class="field-label">Typ ≈∫r√≥d≈Ça SQL <span class="req-star">*</span>
                  <i class="tip-btn">?<span class="tip-popup">VIEW = ukrywa SQL przed CR (zalecane). SP = parametryzacja po stronie bazy. Command Object = inline SQL bezpo≈õrednio w CR.</span></i>
                </label>
                <select class="fs" id="sqlType" required onchange="toggleSqlFields();onFieldChange(this)">
                  <option value="">‚Äî wybierz typ ‚Äî</option>
                  <option value="view">Widok (VIEW)</option>
                  <option value="proc">Procedura sk≈Çadowana (SP)</option>
                  <option value="fn">Funkcja tabelaryczna (TVF)</option>
                  <option value="query">Zapytanie SQL inline</option>
                </select>
              </div>
              <div class="field"><label class="field-label">Baza danych / Connection ID <span class="req-star">*</span><i class="tip-btn">?<span class="tip-popup">Nazwa bazy lub klucz Connection String z appsettings.json. Programista u≈ºyje tej nazwy w kodzie C#.</span></i></label><input type="text" class="fc" placeholder="np. DB_PRODUKCJA" oninput="onFieldChange(this)"/></div>
              <div class="field"><label class="field-label">Schema <i class="tip-btn">?<span class="tip-popup">Schema bazodanowa ‚Äî domy≈õlnie 'dbo' w SQL Server. Wa≈ºne gdy baza ma wiele schemat√≥w: dbo, reporting, hr.</span></i></label><input type="text" class="fc" placeholder="dbo" oninput="onFieldChange(this)"/></div>
            </div>
            <div class="field" id="sqlObjField" style="display:none;margin-bottom:14px">
              <label class="field-label">Nazwa obiektu (VIEW / SP / Funkcja) <i class="tip-btn">?<span class="tip-popup">Pe≈Çna kwalifikowana nazwa: schema.nazwa np. dbo.v_Sprzedaz. Programista wpisze to w CR Database Expert.</span></i></label>
              <input type="text" class="fc mono" placeholder="np. dbo.v_RaportSprzedazy" oninput="onFieldChange(this)"/>
            </div>
            <div class="field" id="sqlInlineField" style="display:none;margin-bottom:14px">
              <label class="field-label">Zapytanie SQL <i class="tip-btn">?<span class="tip-popup">Wpisane bezpo≈õrednio w CR Command Object. U≈ºyj {?PARAMETR} dla parametr√≥w CR. Elastyczne ale trudniejsze w utrzymaniu.</span></i></label>
              <textarea class="fc mono" rows="5" placeholder="SELECT&#10;  kol1, kol2, kol3&#10;FROM dbo.Tabela t&#10;  INNER JOIN dbo.Inna i ON t.id = i.fk&#10;WHERE t.data >= {?DataOd}" oninput="onFieldChange(this)"></textarea>
              <div class="field-hint"><i class="bi bi-info-circle"></i>Placeholdery {?NazwaParametru} zastƒôpowane przez CR w runtime.</div>
            </div>
            <div class="field">
              <label class="field-label">Opis logiki biznesowej <i class="tip-btn">?<span class="tip-popup">Opisz co zwraca to ≈∫r√≥d≈Ço w jƒôzyku biznesowym. Nie technicznie. Trafi do dokumentacji.</span></i></label>
              <textarea class="fc" placeholder="np. Widok ≈ÇƒÖczy tabele Zam√≥wienia, Klienci i Produkty. Zwraca faktury sprzeda≈ºy z danego okresu z rozbijem na kategorie..." oninput="onFieldChange(this)"></textarea>
            </div>
          </div>
        </div>

        <div class="card card-nth-2">
          <div class="card-head collapsible" onclick="toggleCard(this)">
            <div class="card-ico ci-blue"><i class="bi bi-toggles"></i></div>
            <span class="card-title">Dodatkowe opcje</span>
            <i class="bi bi-chevron-down collapse-chevron ms-auto"></i>
          </div>
          <div class="card-body">
            <div class="form-row cols-3">
              <div class="toggle-row"><label class="toggle-sw"><input type="checkbox" id="swCR"><div class="toggle-track"><div class="toggle-thumb"></div></div></label><span class="toggle-label">Command mode (CR Command Object) <i class="tip-btn" style="vertical-align:middle">?<span class="tip-popup">SQL bezpo≈õrednio w CR bez widoku w bazie. Wygodne jednorazowo, trudniejsze d≈Çugoterminowo.</span></i></span></div>
              <div class="toggle-row"><label class="toggle-sw"><input type="checkbox" id="swLinked"><div class="toggle-track"><div class="toggle-thumb"></div></div></label><span class="toggle-label">Wiele tabel z linkowaniem <i class="tip-btn" style="vertical-align:middle">?<span class="tip-popup">CR ≈ÇƒÖczy tabele przez Database Expert ‚Üí Links. Mniej wydajne ni≈º JOIN w SQL.</span></i></span></div>
              <div class="toggle-row"><label class="toggle-sw"><input type="checkbox" id="swLimit"><div class="toggle-track"><div class="toggle-thumb"></div></div></label><span class="toggle-label">Ogranicz liczbƒô wierszy <i class="tip-btn" style="vertical-align:middle">?<span class="tip-popup">CR Max Rows to Retrieve. Warto≈õƒá 0 = brak limitu. To nie SQL TOP ‚Äî CR pobiera wszystko i przycina po stronie klienta.</span></i></span></div>
            </div>
          </div>
        </div>

        <div class="card card-nth-3">
          <div class="card-head collapsible" onclick="toggleCard(this)">
            <div class="card-ico ci-blue"><i class="bi bi-person-badge"></i></div>
            <span class="card-title">Runtime: logowanie DB</span>
            <span class="card-badge badge-req">WYMAGANE</span>
            <i class="bi bi-chevron-down collapse-chevron ms-auto"></i>
          </div>
          <div class="card-body">
            <div class="form-row cols-2">
              <div class="field"><label class="field-label">Serwer SQL <span class="req-star">*</span></label><input type="text" class="fc mono" placeholder="np. sql-prod-01\INSTANCE" oninput="onFieldChange(this)"/></div>
              <div class="field"><label class="field-label">Baza danych <span class="req-star">*</span></label><input type="text" class="fc" placeholder="np. ReportingDb" oninput="onFieldChange(this)"/></div>
            </div>
            <div class="form-row cols-2">
              <div class="field"><label class="field-label">Tryb autoryzacji <span class="req-star">*</span></label><select class="fs" onchange="onFieldChange(this)"><option value="">‚Äî wybierz ‚Äî</option><option>Windows Integrated</option><option>SQL Login</option><option>Azure AD / Managed Identity</option></select></div>
              <div class="field"><label class="field-label">≈örodowisko runtime <span class="req-star">*</span></label><select class="fs" onchange="onFieldChange(this)"><option value="">‚Äî wybierz ‚Äî</option><option>DEV</option><option>TEST</option><option>UAT</option><option>PROD</option></select></div>
            </div>
            <div class="field-hint"><i class="bi bi-info-circle"></i>Jak u≈ºyƒá w C# runtime: uzupe≈Çnij <code style="font-family:'JetBrains Mono',monospace">ConnectionInfo</code>, nastƒôpnie przypisz do tabel przez <code style="font-family:'JetBrains Mono',monospace">ApplyLogOnInfo()</code>.</div>
          </div>
        </div>

        <div class="card card-nth-4">
          <div class="card-head collapsible" onclick="toggleCard(this)">
            <div class="card-ico ci-blue"><i class="bi bi-diagram-3"></i></div>
            <span class="card-title">Mapowanie tabel po SetDataSource / ApplyLogOnInfo</span>
            <span class="card-badge badge-req">WYMAGANE</span>
            <i class="bi bi-chevron-down collapse-chevron ms-auto"></i>
          </div>
          <div class="card-body">
            <div class="form-row cols-2">
              <div class="field"><label class="field-label">Mapowanie tabel raportu g≈Ç√≥wnego <span class="req-star">*</span></label><textarea class="fc mono" rows="3" placeholder="np. dbo.v_RaportSprzedazy -> ds.Tables[\"Main\"]" oninput="onFieldChange(this)"></textarea></div>
              <div class="field"><label class="field-label">Mapowanie tabel podraport√≥w <span class="req-star">*</span></label><textarea class="fc mono" rows="3" placeholder="np. SR_Pozycje: dbo.v_Pozycje -> ds.Tables[\"Items\"]" oninput="onFieldChange(this)"></textarea></div>
            </div>
            <div class="field"><label class="field-label">Strategia iteracji tabel <span class="req-star">*</span></label><select class="fs" onchange="onFieldChange(this)"><option value="">‚Äî wybierz ‚Äî</option><option>Najpierw report.Database.Tables, potem subreporty</option><option>Wy≈ÇƒÖcznie SetDataSource(DataSet)</option><option>Hybrydowo: ApplyLogOnInfo + SetDataSource</option></select></div>
            <div class="field-hint"><i class="bi bi-info-circle"></i>Jak u≈ºyƒá w C# runtime: iteruj po <code style="font-family:'JetBrains Mono',monospace">report.Database.Tables</code> i <code style="font-family:'JetBrains Mono',monospace">report.Subreports</code>, dla ka≈ºdej tabeli zastosuj ten sam login i mapowanie datasetu.</div>
          </div>
        </div>

        <div class="card card-nth-5">
          <div class="card-head collapsible" onclick="toggleCard(this)">
            <div class="card-ico ci-yellow"><i class="bi bi-stopwatch"></i></div>
            <span class="card-title">Timeouty i limity</span>
            <span class="card-badge badge-req">WYMAGANE</span>
            <i class="bi bi-chevron-down collapse-chevron ms-auto"></i>
          </div>
          <div class="card-body">
            <div class="form-row cols-3">
              <div class="field"><label class="field-label">Maks. liczba rekord√≥w <span class="req-star">*</span></label><input type="number" class="fc" min="0" placeholder="np. 200000" oninput="onFieldChange(this)"/></div>
              <div class="field"><label class="field-label">Timeout zapytania SQL (s) <span class="req-star">*</span></label><input type="number" class="fc" min="1" placeholder="np. 120" oninput="onFieldChange(this)"/></div>
              <div class="field"><label class="field-label">Timeout renderowania CR (s) <span class="req-star">*</span></label><input type="number" class="fc" min="1" placeholder="np. 180" oninput="onFieldChange(this)"/></div>
            </div>
            <div class="field"><label class="field-label">Zachowanie po przekroczeniu limitu <span class="req-star">*</span></label><select class="fs" onchange="onFieldChange(this)"><option value="">‚Äî wybierz ‚Äî</option><option>Przerwij i zwr√≥ƒá b≈ÇƒÖd u≈ºytkownikowi</option><option>Przytnij wynik i poka≈º ostrze≈ºenie</option><option>Prze≈ÇƒÖcz na tryb asynchroniczny (kolejka)</option></select></div>
            <div class="field-hint"><i class="bi bi-info-circle"></i>Jak u≈ºyƒá w C# runtime: ustaw timeout na <code style="font-family:'JetBrains Mono',monospace">SqlCommand.CommandTimeout</code> i egzekwuj limity przed <code style="font-family:'JetBrains Mono',monospace">ExportToStream()</code>.</div>
          </div>
        </div>

        <div class="card card-nth-6">
          <div class="card-head collapsible" onclick="toggleCard(this)">
            <div class="card-ico ci-red"><i class="bi bi-shield-lock"></i></div>
            <span class="card-title">Polityka bezpiecze≈Ñstwa danych</span>
            <span class="card-badge badge-req">WYMAGANE</span>
            <i class="bi bi-chevron-down collapse-chevron ms-auto"></i>
          </div>
          <div class="card-body">
            <div class="form-row cols-2">
              <div class="field"><label class="field-label">Pola wra≈ºliwe do maskowania <span class="req-star">*</span></label><textarea class="fc" rows="3" placeholder="np. PESEL, NIP, nr_konta, email" oninput="onFieldChange(this)"></textarea></div>
              <div class="field"><label class="field-label">Regu≈Ça maskowania <span class="req-star">*</span></label><textarea class="fc mono" rows="3" placeholder="np. PESEL -> ***********, email -> a***@firma.pl" oninput="onFieldChange(this)"></textarea></div>
            </div>
            <div class="field"><label class="field-label">Role uprawnie≈Ñ do raportu <span class="req-star">*</span></label><input type="text" class="fc" placeholder="np. CR_VIEWER, CR_MANAGER, CR_AUDITOR" oninput="onFieldChange(this)"/></div>
            <div class="field-hint"><i class="bi bi-info-circle"></i>Jak u≈ºyƒá w C# runtime: maskuj dane przed <code style="font-family:'JetBrains Mono',monospace">SetDataSource()</code> i waliduj role u≈ºytkownika przed wygenerowaniem raportu.</div>
          </div>
        </div>

        <div class="card card-nth-7">
          <div class="card-head collapsible" onclick="toggleCard(this)">
            <div class="card-ico ci-green"><i class="bi bi-globe2"></i></div>
            <span class="card-title">Lokalizacja i formatowanie</span>
            <span class="card-badge badge-req">WYMAGANE</span>
            <i class="bi bi-chevron-down collapse-chevron ms-auto"></i>
          </div>
          <div class="card-body">
            <div class="form-row cols-3">
              <div class="field"><label class="field-label">Locale / kultura <span class="req-star">*</span></label><input type="text" class="fc mono" placeholder="np. pl-PL" oninput="onFieldChange(this)"/></div>
              <div class="field"><label class="field-label">Strefa czasowa <span class="req-star">*</span></label><input type="text" class="fc" placeholder="np. Europe/Warsaw" oninput="onFieldChange(this)"/></div>
              <div class="field"><label class="field-label">Format daty i liczby <span class="req-star">*</span></label><input type="text" class="fc mono" placeholder="np. dd.MM.yyyy | #,##0.00" oninput="onFieldChange(this)"/></div>
            </div>
            <div class="field-hint"><i class="bi bi-info-circle"></i>Jak u≈ºyƒá w C# runtime: ustaw <code style="font-family:'JetBrains Mono',monospace">CultureInfo</code> i konwertuj daty do w≈Ça≈õciwej strefy przed podaniem danych do raportu.</div>
          </div>
        </div>

        <div class="card card-nth-8">
          <div class="card-head collapsible" onclick="toggleCard(this)">
            <div class="card-ico ci-blue"><i class="bi bi-send-check"></i></div>
            <span class="card-title">Dystrybucja i harmonogram</span>
            <span class="card-badge badge-req">WYMAGANE</span>
            <i class="bi bi-chevron-down collapse-chevron ms-auto"></i>
          </div>
          <div class="card-body">
            <div class="form-row cols-3">
              <div class="field"><label class="field-label">Tryb uruchamiania <span class="req-star">*</span></label><select class="fs" onchange="onFieldChange(this)"><option value="">‚Äî wybierz ‚Äî</option><option>On-demand (na ≈ºƒÖdanie)</option><option>Scheduled (harmonogram)</option><option>Oba tryby</option></select></div>
              <div class="field"><label class="field-label">Kana≈Ç dystrybucji <span class="req-star">*</span></label><select class="fs" onchange="onFieldChange(this)"><option value="">‚Äî wybierz ‚Äî</option><option>PDF</option><option>XLSX</option><option>E-mail (za≈ÇƒÖcznik)</option><option>PDF + XLSX + e-mail</option></select></div>
              <div class="field"><label class="field-label">Harmonogram CRON / interwa≈Ç <span class="req-star">*</span></label><input type="text" class="fc mono" placeholder="np. 0 0 6 * * 1-5" oninput="onFieldChange(this)"/></div>
            </div>
            <div class="field"><label class="field-label">Lista odbiorc√≥w / grupa docelowa <span class="req-star">*</span></label><textarea class="fc" rows="2" placeholder="np. finanse@firma.pl; controlling@firma.pl" oninput="onFieldChange(this)"></textarea></div>
            <div class="field-hint"><i class="bi bi-info-circle"></i>Jak u≈ºyƒá w C# runtime: dla on-demand wywo≈Çuj eksport synchronicznie, a dla scheduled zapisuj zlecenie do joba i wysy≈Çaj wynik jako PDF/XLSX/mail.</div>
          </div>
        </div>

        <div class="nav-actions">
          <button class="btn-secondary" onclick="goTab('t1')"><i class="bi bi-arrow-left"></i> Wr√≥ƒá</button>
          <button class="btn-primary" onclick="goTab('t3')">Dalej: Kolumny <i class="bi bi-arrow-right"></i></button>
        </div>
      </div>

      <!-- ‚ïê‚ïê TAB 3 ‚ïê‚ïê -->
      <div class="tab-pane" id="t3">
        <div class="step-indicator"><div class="step-dot"></div>Krok 3 z 10</div>
        <div class="page-header"><h1>Kolumny raportu</h1><p>Zdefiniuj ka≈ºdƒÖ kolumnƒô ‚Äî pole DB, nag≈Ç√≥wek, typ, format i regu≈Çy formatowania warunkowego.</p></div>

        <div class="card card-nth-1">
          <div class="card-head collapsible" onclick="toggleCard(this)">
            <div class="card-ico ci-blue"><i class="bi bi-fonts"></i></div>
            <span class="card-title">Tryb nag≈Ç√≥wk√≥w kolumn</span>
            <i class="bi bi-chevron-down collapse-chevron ms-auto"></i>
          </div>
          <div class="card-body">
            <div class="radio-group mb-2">
              <div class="rpill"><input type="radio" name="hm" id="hm1" value="static" checked onchange="setHM('static')"><label for="hm1">Statyczne</label></div>
              <div class="rpill"><input type="radio" name="hm" id="hm2" value="param" onchange="setHM('param')"><label for="hm2">Z parametru CR ({?X})</label></div>
              <div class="rpill"><input type="radio" name="hm" id="hm3" value="formula" onchange="setHM('formula')"><label for="hm3">Z formu≈Çy CR ({@X})</label></div>
              <div class="rpill"><input type="radio" name="hm" id="hm4" value="mixed" onchange="setHM('mixed')"><label for="hm4">Mieszany (per kolumna)</label></div>
            </div>
            <div class="field-hint" id="hmHint"><i class="bi bi-info-circle"></i>Statyczny nag≈Ç√≥wek to sta≈Çy tekst w CR Designer ‚Äî nie zmienia siƒô w runtime.</div>
          </div>
        </div>

        <div class="card card-nth-2">
          <div class="card-head collapsible" onclick="toggleCard(this)">
            <div class="card-ico ci-blue"><i class="bi bi-columns-gap"></i></div>
            <span class="card-title">Definicja kolumn</span>
            <span class="card-badge badge-req">WYMAGANE</span>
            <i class="bi bi-chevron-down collapse-chevron ms-auto"></i>
          </div>
          <div class="card-body">
            <div class="dt-wrap">
              <table class="dt" id="colTable">
                <thead><tr>
                  <th></th><th>‚Üï</th><th>#</th>
                  <th>Pole DB / formu≈Ça <i class="tip-btn" style="font-size:9px">?<span class="tip-popup">Nazwa pola z widoku/SP lub formu≈Çy CR np. {@NazwaFormuly}. Musi dok≈Çadnie odpowiadaƒá kolumnie.</span></i></th>
                  <th>Nag≈Ç√≥wek</th><th>Typ danych</th><th>Format / maska</th>
                  <th>Widoczna</th><th>Sumowaƒá</th><th>Wyr√≥w.</th><th>CF</th><th></th>
                </tr></thead>
                <tbody id="colBody">
                  <tr>
                    <td><span class="drag-handle"><i class="bi bi-grip-vertical"></i></span></td>
                    <td>
                      <div class="row-move">
                        <button class="btn-move" type="button" onclick="moveColRow(this,-1)" title="Przesu≈Ñ w g√≥rƒô"><i class="bi bi-chevron-up"></i></button>
                        <button class="btn-move" type="button" onclick="moveColRow(this,1)" title="Przesu≈Ñ w d√≥≈Ç"><i class="bi bi-chevron-down"></i></button>
                      </div>
                    </td>
                    <td class="row-num">1</td>
                    <td><input type="text" class="mono" placeholder="total_amount"/></td>
                    <td><input type="text" placeholder="Warto≈õƒá"/></td>
                    <td><select><option>‚Äî</option><option>String</option><option>Number</option><option>Currency</option><option>Date</option><option>DateTime</option><option>Boolean</option><option>Percent</option><option>Formula</option></select></td>
                    <td><input type="text" placeholder="#,##0.00"/></td>
                    <td style="text-align:center"><input type="checkbox" checked/></td>
                    <td style="text-align:center"><input type="checkbox"/></td>
                    <td><select><option>L</option><option>≈ö</option><option>P</option></select></td>
                    <td><select><option>Brak</option><option>Kolor</option><option>T≈Ço</option><option>Bold</option><option>Wiele</option></select></td>
                    <td><button class="btn-rm" onclick="removeRow(this)"><i class="bi bi-trash3"></i></button></td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:12px">
              <button class="btn-add" onclick="addColRow()"><i class="bi bi-plus-lg"></i>Dodaj kolumnƒô</button>
              <button class="btn-add" onclick="addFormulaCol()"><i class="bi bi-calculator"></i>Formula Field</button>
              <button class="btn-add" onclick="addRunningTotal()"><i class="bi bi-123"></i>Running Total</button>
            </div>
          </div>
        </div>

        <div class="card card-nth-3">
          <div class="card-head collapsible" onclick="toggleCard(this)">
            <div class="card-ico ci-yellow"><i class="bi bi-palette"></i></div>
            <span class="card-title">Formatowanie warunkowe (Conditional Formatting)</span>
            <i class="bi bi-chevron-down collapse-chevron ms-auto"></i>
          </div>
          <div class="card-body">
            <div class="info-alert"><i class="bi bi-info-circle"></i>CR Highlighting Expert ‚Äî regu≈Çy zmieniajƒÖce kolor/styl kom√≥rek na podstawie warto≈õci np. ujemne = czerwone.</div>
            <div class="dt-wrap">
              <table class="dt" id="cfTable">
                <thead><tr><th>#</th><th>Kolumna</th><th>Warunek CR <i class="tip-btn" style="font-size:9px">?<span class="tip-popup">Formu≈Ça CR np. {pole} &lt; 0 lub {pole} &gt; {?Prog}. Odwo≈Çuje siƒô do p√≥l i parametr√≥w.</span></i></th><th>Efekt</th><th>Kolor tekstu</th><th>Kolor t≈Ça</th><th>Styl</th><th>Opis</th><th></th></tr></thead>
                <tbody id="cfBody">
                  <tr>
                    <td class="row-num">1</td>
                    <td><input type="text" placeholder="total_amount" class="mono"/></td>
                    <td><input type="text" placeholder="{total_amount} &lt; 0" class="mono"/></td>
                    <td><select><option>Kolor tekstu</option><option>Kolor t≈Ça</option><option>Oba</option><option>Bold</option><option>Kursywa</option></select></td>
                    <td><input type="color" value="#dc2626"/></td>
                    <td><input type="color" value="#fee2e2"/></td>
                    <td><select><option>Normal</option><option>Bold</option><option>Italic</option></select></td>
                    <td><input type="text" placeholder="Warto≈õƒá ujemna"/></td>
                    <td>
                      <div class="row-actions">
                        <div class="row-move">
                          <button class="btn-move" type="button" onclick="moveRow(this,-1)" title="Przesu≈Ñ w g√≥rƒô"><i class="bi bi-chevron-up"></i></button>
                          <button class="btn-move" type="button" onclick="moveRow(this,1)" title="Przesu≈Ñ w d√≥≈Ç"><i class="bi bi-chevron-down"></i></button>
                        </div>
                        <button class="btn-rm" onclick="removeRow(this)"><i class="bi bi-trash3"></i></button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button class="btn-add mt-3" onclick="addCFRow()"><i class="bi bi-plus-lg"></i>Dodaj regu≈Çƒô CF</button>
          </div>
        </div>

        <div class="nav-actions">
          <button class="btn-secondary" onclick="goTab('t2')"><i class="bi bi-arrow-left"></i> Wr√≥ƒá</button>
          <button class="btn-primary" onclick="goTab('t4')">Dalej: Parametry <i class="bi bi-arrow-right"></i></button>
        </div>
      </div>

      <!-- ‚ïê‚ïê TAB 4 ‚ïê‚ïê -->
      <div class="tab-pane" id="t4">
        <div class="step-indicator"><div class="step-dot"></div>Krok 4 z 10</div>
        <div class="page-header"><h1>Parametry CR</h1><p>Parametry przekazywane z kodu C# przez <code style="font-family:'JetBrains Mono',monospace;background:var(--a-l);padding:1px 6px;border-radius:4px;color:var(--a)">SetParameterValue()</code> przy uruchamianiu raportu.</p></div>
        <div class="info-alert"><i class="bi bi-info-circle"></i>Ka≈ºdy parametr musi byƒá ustawiony przed wywo≈Çaniem <code style="font-family:'JetBrains Mono',monospace">report.SetParameterValue("Nazwa", warto≈õƒá)</code>. Kontrolki UI w Razor Pages automatycznie mapowane na parametry.</div>
        <div class="card card-nth-1">
          <div class="card-head"><div class="card-ico ci-blue"><i class="bi bi-sliders"></i></div><span class="card-title">Lista parametr√≥w</span></div>
          <div class="card-body">
            <div class="dt-wrap">
              <table class="dt">
                <thead><tr><th>#</th><th>Nazwa CR <i class="tip-btn" style="font-size:9px">?<span class="tip-popup">Bez {?}. Identyczna z argumentem SetParameterValue(). Bez spacji i polskich znak√≥w.</span></i></th><th>Typ</th><th>Domy≈õlna <i class="tip-btn" style="font-size:9px">?<span class="tip-popup">Warto≈õƒá gdy u≈ºytkownik nie poda w≈Çasnej. {dzi≈õ-30d} = aktualna data minus 30 dni.</span></i></th><th>Wymagany</th><th>Multi</th><th>Kontrolka UI</th><th>LOV SQL</th><th>Opis</th><th></th></tr></thead>
                <tbody id="paramBody">
                  <tr>
                    <td class="row-num">1</td>
                    <td><input type="text" placeholder="DataOd" class="mono"/></td>
                    <td><select><option>‚Äî</option><option>String</option><option>Number</option><option>Date</option><option>DateTime</option><option>Boolean</option></select></td>
                    <td><input type="text" placeholder="{dzi≈õ-30d}"/></td>
                    <td style="text-align:center"><input type="checkbox"/></td>
                    <td style="text-align:center"><input type="checkbox"/></td>
                    <td><select><option>DatePicker</option><option>TextBox</option><option>Dropdown</option><option>MultiSelect</option><option>Ukryta</option></select></td>
                    <td><input type="text" class="mono" placeholder="SELECT id,nazwa FROM..."/></td>
                    <td><input type="text" placeholder="Opis"/></td>
                    <td>
                      <div class="row-actions">
                        <div class="row-move">
                          <button class="btn-move" type="button" onclick="moveRow(this,-1)" title="Przesu≈Ñ w g√≥rƒô"><i class="bi bi-chevron-up"></i></button>
                          <button class="btn-move" type="button" onclick="moveRow(this,1)" title="Przesu≈Ñ w d√≥≈Ç"><i class="bi bi-chevron-down"></i></button>
                        </div>
                        <button class="btn-rm" onclick="removeRow(this)"><i class="bi bi-trash3"></i></button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button class="btn-add mt-3" onclick="addParamRow()"><i class="bi bi-plus-lg"></i>Dodaj parametr</button>
          </div>
        </div>
        <div class="nav-actions">
          <button class="btn-secondary" onclick="goTab('t3')"><i class="bi bi-arrow-left"></i> Wr√≥ƒá</button>
          <button class="btn-primary" onclick="goTab('t5')">Dalej: Filtry <i class="bi bi-arrow-right"></i></button>
        </div>
      </div>

      <!-- ‚ïê‚ïê TAB 5 ‚ïê‚ïê -->
      <div class="tab-pane" id="t5">
        <div class="step-indicator"><div class="step-dot"></div>Krok 5 z 10</div>
        <div class="page-header"><h1>Filtry i selekcja</h1><p>Warunki filtrowania na poziomie SQL WHERE lub CR Record Selection Formula.</p></div>
        <div class="card card-nth-1">
          <div class="card-head collapsible" onclick="toggleCard(this)">
            <div class="card-ico ci-green"><i class="bi bi-layers"></i></div>
            <span class="card-title">Strategia filtrowania</span>
            <i class="bi bi-chevron-down collapse-chevron ms-auto"></i>
          </div>
          <div class="card-body">
            <div class="radio-group">
              <div class="rpill"><input type="radio" name="fs" id="fs1" checked><label for="fs1">SQL WHERE (push-down)</label></div>
              <div class="rpill"><input type="radio" name="fs" id="fs2"><label for="fs2">CR Record Selection</label></div>
              <div class="rpill"><input type="radio" name="fs" id="fs3"><label for="fs3">Oba poziomy</label></div>
              <div class="rpill"><input type="radio" name="fs" id="fs4"><label for="fs4">CR Group Selection</label></div>
            </div>
            <div class="field-hint mt-2"><i class="bi bi-info-circle"></i><strong>SQL WHERE</strong> = filtruje w bazie (wydajne). <strong>CR Selection</strong> = po stronie CR ‚Äî gdy nie mo≈ºesz modyfikowaƒá bazy. <strong>Group Selection</strong> = odpowiednik HAVING.</div>
          </div>
        </div>
        <div class="card card-nth-2">
          <div class="card-head collapsible" onclick="toggleCard(this)">
            <div class="card-ico ci-green"><i class="bi bi-diagram-3"></i></div>
            <span class="card-title">Builder warunk√≥w (AND/OR)</span>
            <i class="bi bi-chevron-down collapse-chevron ms-auto"></i>
          </div>
          <div class="card-body">
            <div id="filterGroups"></div>
            <button class="btn-add" onclick="addFilterGroup()"><i class="bi bi-plus-square"></i>Dodaj grupƒô AND/OR</button>
          </div>
        </div>
        <div class="card card-nth-3">
          <div class="card-head collapsible" onclick="toggleCard(this)">
            <div class="card-ico ci-green"><i class="bi bi-code-square"></i></div>
            <span class="card-title">CR Selection Formula (rƒôczna)</span>
            <i class="bi bi-chevron-down collapse-chevron ms-auto"></i>
          </div>
          <div class="card-body">
            <div class="field mb-3">
              <label class="field-label">CR Record Selection Formula <i class="tip-btn">?<span class="tip-popup">Nadpisuje builder. Sk≈Çadnia Crystal Syntax. Widoczna w CR Designer ‚Üí Report ‚Üí Edit Selection Formula ‚Üí Record.</span></i></label>
              <textarea class="fc mono" rows="3" placeholder='{Orders.OrderDate} in {?DataOd} to {?DataDo} and {Orders.Status} = "AKTYWNY"'></textarea>
            </div>
            <div class="field">
              <label class="field-label">CR Group Selection Formula <i class="tip-btn">?<span class="tip-popup">Filtruje grupy po agregacji ‚Äî odpowiednik SQL HAVING. CR Designer ‚Üí Report ‚Üí Edit Selection Formula ‚Üí Group.</span></i></label>
              <textarea class="fc mono" rows="2" placeholder="Sum({Orders.Kwota}, {Orders.Kategoria}) > 10000"></textarea>
            </div>
          </div>
        </div>
        <div class="nav-actions">
          <button class="btn-secondary" onclick="goTab('t4')"><i class="bi bi-arrow-left"></i> Wr√≥ƒá</button>
          <button class="btn-primary" onclick="goTab('t6')">Dalej: Grupowanie <i class="bi bi-arrow-right"></i></button>
        </div>
      </div>

      <!-- ‚ïê‚ïê TAB 6 ‚ïê‚ïê -->
      <div class="tab-pane" id="t6">
        <div class="step-indicator"><div class="step-dot"></div>Krok 6 z 10</div>
        <div class="page-header"><h1>Grupowanie i sortowanie</h1><p>Hierarchia grupowania CR ‚Äî Group Headers, Footers i podsumowania per poziom.</p></div>
        <div class="card card-nth-1">
          <div class="card-head"><div class="card-ico ci-yellow"><i class="bi bi-collection"></i></div><span class="card-title">Poziomy grupowania</span></div>
          <div class="card-body">
            <div class="info-alert"><i class="bi bi-info-circle"></i>Grupy sƒÖ hierarchiczne ‚Äî Grupa 1 jest nadrzƒôdna. CR automatycznie tworzy Group Header i Footer. Maks. 5 poziom√≥w.</div>
            <div class="dt-wrap">
              <table class="dt">
                <thead><tr><th>#</th><th>Pole grupowania</th><th>Kolejno≈õƒá</th><th>Podsumowanie</th><th>Pole sumy</th><th>PageBreak</th><th>Ukryj detal</th><th>Nag≈Ç√≥wek</th><th>Stopka</th><th></th></tr></thead>
                <tbody id="groupBody">
                  <tr>
                    <td class="row-num">1</td>
                    <td><input type="text" placeholder="kategoria" class="mono"/></td>
                    <td><select><option>ASC</option><option>DESC</option><option>Custom</option></select></td>
                    <td><select><option>Brak</option><option>SUM</option><option>COUNT</option><option>AVG</option><option>MIN</option><option>MAX</option></select></td>
                    <td><input type="text" placeholder="pole_kwota" class="mono"/></td>
                    <td style="text-align:center"><input type="checkbox"/></td>
                    <td style="text-align:center"><input type="checkbox"/></td>
                    <td><input type="text" placeholder="Kategoria: {pole}"/></td>
                    <td><input type="text" placeholder="Razem: {SUM}"/></td>
                    <td>
                      <div class="row-actions">
                        <div class="row-move">
                          <button class="btn-move" type="button" onclick="moveRow(this,-1)" title="Przesu≈Ñ w g√≥rƒô"><i class="bi bi-chevron-up"></i></button>
                          <button class="btn-move" type="button" onclick="moveRow(this,1)" title="Przesu≈Ñ w d√≥≈Ç"><i class="bi bi-chevron-down"></i></button>
                        </div>
                        <button class="btn-rm" onclick="removeRow(this)"><i class="bi bi-trash3"></i></button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <button class="btn-add mt-3" onclick="addGroupRow()"><i class="bi bi-plus-lg"></i>Dodaj poziom grupowania</button>
          </div>
        </div>
        <div class="nav-actions">
          <button class="btn-secondary" onclick="goTab('t5')"><i class="bi bi-arrow-left"></i> Wr√≥ƒá</button>
          <button class="btn-primary" onclick="goTab('t7')">Dalej: Podraporty <i class="bi bi-arrow-right"></i></button>
        </div>
      </div>

      <!-- ‚ïê‚ïê TAB 7 ‚ïê‚ïê -->
      <div class="tab-pane" id="t7">
        <div class="step-indicator"><div class="step-dot"></div>Krok 7 z 10</div>
        <div class="page-header"><h1>Podraporty (Subreports)</h1><p>Osadzone raporty z w≈Çasnym ≈∫r√≥d≈Çem danych, powiƒÖzane z raportem g≈Ç√≥wnym przez SubreportLinks.</p></div>
        <div class="form-row cols-2 mb-3">
          <div class="info-alert m-0"><i class="bi bi-check-circle"></i><div><strong>Kiedy u≈ºywaƒá:</strong> inne ≈∫r√≥d≈Ço danych, inna granularno≈õƒá (nag≈Ç√≥wek + pozycje), drill-down on-demand.</div></div>
          <div class="warn-alert m-0"><i class="bi bi-exclamation-triangle"></i><div><strong>Uwaga wydajno≈õciowa:</strong> ka≈ºdy SR = osobne zapytanie SQL. Rozwa≈º JOIN lub PIVOT zamiast podraportu.</div></div>
        </div>
        <div id="subreportList"></div>
        <button class="btn-add" onclick="addSubreport()"><i class="bi bi-plus-lg"></i>Dodaj podraport</button>
        <div class="nav-actions">
          <button class="btn-secondary" onclick="goTab('t6')"><i class="bi bi-arrow-left"></i> Wr√≥ƒá</button>
          <button class="btn-primary" onclick="goTab('t8')">Dalej: Nag≈Ç√≥wki/Stopki <i class="bi bi-arrow-right"></i></button>
        </div>
      </div>

      <!-- ‚ïê‚ïê TAB 8 ‚ïê‚ïê -->
      <div class="tab-pane" id="t8">
        <div class="step-indicator"><div class="step-dot"></div>Krok 8 z 10</div>
        <div class="page-header"><h1>Nag≈Ç√≥wki i stopki</h1><p>Skonfiguruj 4 strefy CR: Report Header, Page Header, Page Footer, Report Footer.</p></div>
        <div class="card card-nth-1">
          <div class="card-head collapsible" onclick="toggleCard(this)">
            <div class="card-ico ci-green"><i class="bi bi-braces"></i></div>
            <span class="card-title">Tokeny dynamiczne</span>
            <i class="bi bi-chevron-down collapse-chevron ms-auto"></i>
          </div>
          <div class="card-body">
            <div class="field-hint mb-2"><i class="bi bi-info-circle"></i>Kliknij token aby wstawiƒá do ostatnio aktywnego pola tekstowego.</div>
            <div class="token-chips">
              <span class="tchip" onclick="insertToken('{PageNumber}')">{PageNumber}</span>
              <span class="tchip" onclick="insertToken('{TotalPages}')">{TotalPages}</span>
              <span class="tchip" onclick="insertToken('{PrintDate}')">{PrintDate}</span>
              <span class="tchip" onclick="insertToken('{PrintTime}')">{PrintTime}</span>
              <span class="tchip" onclick="insertToken('{ReportName}')">{ReportName}</span>
              <span class="tchip g" onclick="insertToken('{?DataOd}')">{?DataOd}</span>
              <span class="tchip g" onclick="insertToken('{?DataDo}')">{?DataDo}</span>
              <span class="tchip g" onclick="insertToken('{?U≈ºytkownik}')">{?U≈ºytkownik}</span>
              <span class="tchip y" onclick="insertToken('{@Tytu≈ÇRaportu}')">{@Tytu≈ÇRaportu}</span>
              <span class="tchip y" onclick="insertToken('{@NazwaFirmy}')">{@NazwaFirmy}</span>
            </div>
          </div>
        </div>

        <!-- Report Header -->
        <div class="hf-zone">
          <div class="hf-zone-head hf-rh" onclick="toggleHF(this)">
            <i class="bi bi-file-earmark-text"></i><strong>Report Header</strong> ‚Äî raz, na poczƒÖtku pierwszej strony
            <i class="bi bi-chevron-down hf-chevron"></i>
          </div>
          <div class="hf-body">
            <div class="form-row cols-2">
              <div class="field"><label class="field-label">G≈Ç√≥wny tytu≈Ç <span class="req-star">*</span> <i class="tip-btn">?<span class="tip-popup">Tytu≈Ç widoczny na poczƒÖtku raportu ‚Äî du≈ºa czcionka, raz. Mo≈ºe zawieraƒá tokeny CR.</span></i></label><input type="text" class="fc" id="rhTitle" placeholder="RAPORT SPRZEDA≈ªY ‚Äî {?MiesiƒÖc} {?Rok}" oninput="onFieldChange(this)"/></div>
              <div class="field"><label class="field-label">Podtytu≈Ç / zakres <i class="tip-btn">?<span class="tip-popup">Linia pod tytu≈Çem ‚Äî zakres dat, aktywne filtry.</span></i></label><input type="text" class="fc" placeholder="Okres: {?DataOd} ‚Äî {?DataDo}" oninput="onFieldChange(this)"/></div>
            </div>
            <div class="form-row cols-3">
              <div class="field"><label class="field-label">Logo firmy</label><select class="fs"><option>Brak</option><option>Embedded w .rpt</option><option>Dynamiczne (BLOB)</option><option>≈öcie≈ºka UNC</option></select></div>
              <div class="field"><label class="field-label">Pozycja logo</label><select class="fs"><option>Lewy g√≥rny</option><option>Prawy g√≥rny</option><option>≈örodek</option></select></div>
              <div class="field"><label class="field-label">RH na osobnej stronie</label><select class="fs"><option>Nie</option><option>Tak (New Page After)</option></select></div>
            </div>
            <div class="field"><label class="field-label">Elementy dodatkowe <i class="tip-btn">?<span class="tip-popup">Nota prawna, klauzula poufno≈õci, numer wersji, dzia≈Ç zamawiajƒÖcy.</span></i></label><textarea class="fc" rows="2" placeholder="np. Dokument poufny ‚Äî do u≈ºytku wewnƒôtrznego. Dzia≈Ç: Sprzeda≈º." oninput="onFieldChange(this)"></textarea></div>
          </div>
        </div>

        <!-- Page Header -->
        <div class="hf-zone">
          <div class="hf-zone-head hf-ph" onclick="toggleHF(this)">
            <i class="bi bi-layout-text-window"></i><strong>Page Header</strong> ‚Äî powtarzany na ka≈ºdej stronie
            <i class="bi bi-chevron-down hf-chevron"></i>
          </div>
          <div class="hf-body">
            <div class="form-row cols-3">
              <div class="field"><label class="field-label">Lewo</label><input type="text" class="fc" placeholder="ABC Sp. z o.o." oninput="onFieldChange(this)"/></div>
              <div class="field"><label class="field-label">≈örodek</label><input type="text" class="fc" placeholder="Raport Sprzeda≈ºy" oninput="onFieldChange(this)"/></div>
              <div class="field"><label class="field-label">Prawo</label><input type="text" class="fc" placeholder="Wydrukowano: {PrintDate}" oninput="onFieldChange(this)"/></div>
            </div>
            <div class="form-row cols-2">
              <div class="field"><label class="field-label">Linia oddzielajƒÖca</label><select class="fs"><option>Brak</option><option>Cienka</option><option>Gruba</option><option>Podw√≥jna</option></select></div>
              <div class="field"><label class="field-label">Nag≈Ç√≥wki kolumn w PH</label><select class="fs"><option>Powtarzaj na ka≈ºdej stronie</option><option>Tylko pierwsza strona</option><option>Nie</option></select></div>
            </div>
            <div class="toggle-row"><label class="toggle-sw"><input type="checkbox"><div class="toggle-track"><div class="toggle-thumb"></div></div></label><span class="toggle-label">Ukryj PH na pierwszej stronie <i class="tip-btn" style="vertical-align:middle">?<span class="tip-popup">Suppress PH on first page ‚Äî bo pierwsza strona ma ju≈º Report Header. CR: {PageNumber} = 1 ‚Üí Suppress.</span></i></span></div>
          </div>
        </div>

        <!-- Page Footer -->
        <div class="hf-zone">
          <div class="hf-zone-head hf-pf" onclick="toggleHF(this)">
            <i class="bi bi-layout-text-window-reverse"></i><strong>Page Footer</strong> ‚Äî powtarzany na ka≈ºdej stronie
            <i class="bi bi-chevron-down hf-chevron"></i>
          </div>
          <div class="hf-body">
            <div class="form-row cols-3">
              <div class="field"><label class="field-label">Lewo</label><input type="text" class="fc" placeholder="¬© 2024 Firma" oninput="onFieldChange(this)"/></div>
              <div class="field"><label class="field-label">≈örodek</label><input type="text" class="fc" placeholder="Poufne" oninput="onFieldChange(this)"/></div>
              <div class="field"><label class="field-label">Prawo (numeracja) <i class="tip-btn">?<span class="tip-popup">Format numeracji stron. {PageNumber} i {TotalPages} sƒÖ polami CR.</span></i></label><input type="text" class="fc" placeholder="Strona {PageNumber} / {TotalPages}" oninput="onFieldChange(this)"/></div>
            </div>
          </div>
        </div>

        <!-- Report Footer -->
        <div class="hf-zone">
          <div class="hf-zone-head hf-rf" onclick="toggleHF(this)">
            <i class="bi bi-file-earmark-check"></i><strong>Report Footer</strong> ‚Äî raz, po wszystkich danych (ostatnia strona)
            <i class="bi bi-chevron-down hf-chevron"></i>
          </div>
          <div class="hf-body">
            <div class="form-row cols-2">
              <div class="field"><label class="field-label">Tekst podsumowujƒÖcy <i class="tip-btn">?<span class="tip-popup">Tekst na ko≈Ñcu raportu np. "Koniec raportu. Liczba rekord√≥w: {RecordCount}."</span></i></label><textarea class="fc" rows="2" placeholder="Koniec raportu. Liczba rekord√≥w: {RecordCount}." oninput="onFieldChange(this)"></textarea></div>
              <div class="field"><label class="field-label">Agregaty globalne <i class="tip-btn">?<span class="tip-popup">Podsumowanie finansowe ca≈Çego raportu. CR Summary Fields dostƒôpne automatycznie.</span></i></label><textarea class="fc" rows="2" placeholder="SUMA: {SUM_kwota}  |  LICZBA: {COUNT}" oninput="onFieldChange(this)"></textarea></div>
            </div>
          </div>
        </div>

        <div class="nav-actions">
          <button class="btn-secondary" onclick="goTab('t7')"><i class="bi bi-arrow-left"></i> Wr√≥ƒá</button>
          <button class="btn-primary" onclick="goTab('t9')">Dalej: Brak danych <i class="bi bi-arrow-right"></i></button>
        </div>
      </div>

      <!-- ‚ïê‚ïê TAB 9 ‚ïê‚ïê -->
      <div class="tab-pane" id="t9">
        <div class="step-indicator"><div class="step-dot"></div>Krok 9 z 10</div>
        <div class="page-header"><h1>Zachowanie przy braku danych</h1><p>Zdefiniuj co widzi u≈ºytkownik gdy zapytanie nie zwr√≥ci ≈ºadnych rekord√≥w.</p></div>
        <div class="card card-nth-1">
          <div class="card-head collapsible" onclick="toggleCard(this)">
            <div class="card-ico ci-red"><i class="bi bi-sliders"></i></div>
            <span class="card-title">Strategia</span>
            <span class="card-badge badge-ux">UX</span>
            <i class="bi bi-chevron-down collapse-chevron ms-auto"></i>
          </div>
          <div class="card-body">
            <div class="radio-group">
              <div class="rpill"><input type="radio" name="em" id="em1" checked><label for="em1">Komunikat w CR</label></div>
              <div class="rpill"><input type="radio" name="em" id="em2"><label for="em2">Pusta tabela z nag≈Ç√≥wkami</label></div>
              <div class="rpill"><input type="radio" name="em" id="em3"><label for="em3">Komunikat w UI</label></div>
              <div class="rpill"><input type="radio" name="em" id="em4"><label for="em4">Przekieruj do b≈Çƒôdu</label></div>
            </div>
          </div>
        </div>
        <div class="card card-nth-2">
          <div class="card-head collapsible" onclick="toggleCard(this)">
            <div class="card-ico ci-red"><i class="bi bi-chat-square-text"></i></div>
            <span class="card-title">Tre≈õƒá komunikatu</span>
            <i class="bi bi-chevron-down collapse-chevron ms-auto"></i>
          </div>
          <div class="card-body">
            <div class="form-row cols-2">
              <div class="field"><label class="field-label">G≈Ç√≥wny tekst <i class="tip-btn">?<span class="tip-popup">Kr√≥tki, jasny komunikat dla u≈ºytkownika. Max 1-2 zdania. Bez technicznego ≈ºargonu.</span></i></label><input type="text" class="fc" id="emptyMsg" placeholder="Brak danych dla wybranych kryteri√≥w." oninput="updateEmptyPreview()"/></div>
              <div class="field"><label class="field-label">Ikona</label><select class="fs" id="emptyIcon" onchange="updateEmptyPreview()"><option value="bi-inbox">üì≠ Folder pusty</option><option value="bi-search">üîç Brak wynik√≥w</option><option value="bi-exclamation-circle">‚ö†Ô∏è Ostrze≈ºenie</option><option value="bi-database-x">üíæ Brak danych</option></select></div>
            </div>
            <div class="field mb-3"><label class="field-label">Wskaz√≥wka <i class="tip-btn">?<span class="tip-popup">Podpowied≈∫ co zrobiƒá ‚Äî zmie≈Ñ filtry, skontaktuj siƒô z adminem, sprawd≈∫ datƒô.</span></i></label><input type="text" class="fc" id="emptyHint" placeholder="Spr√≥buj poszerzyƒá zakres dat lub zmieniƒá kryteria." oninput="updateEmptyPreview()"/></div>
            <div class="es-preview" id="emptyPreview">
              <span class="es-icon"><i class="bi bi-inbox"></i></span>
              <div class="es-title">Brak danych dla wybranych kryteri√≥w.</div>
              <div class="es-sub">Spr√≥buj poszerzyƒá zakres dat lub zmieniƒá kryteria.</div>
            </div>
          </div>
        </div>
        <div class="nav-actions">
          <button class="btn-secondary" onclick="goTab('t8')"><i class="bi bi-arrow-left"></i> Wr√≥ƒá</button>
          <button class="btn-primary" onclick="goTab('t10')">Dalej: Opcje wyj≈õcia <i class="bi bi-arrow-right"></i></button>
        </div>
      </div>

      <!-- ‚ïê‚ïê TAB 10 ‚ïê‚ïê -->
      <div class="tab-pane" id="t10">
        <div class="step-indicator"><div class="step-dot"></div>Krok 10 z 10 ‚Äî Ostatni krok!</div>
        <div class="page-header"><h1>Opcje wyj≈õcia i eksport</h1><p>Zdefiniuj obs≈Çugiwane formaty eksportu z indywidualnymi ustawieniami dla ka≈ºdego.</p></div>

        <div class="card card-nth-1">
          <div class="card-head collapsible" onclick="toggleCard(this)">
            <div class="card-ico ci-green"><i class="bi bi-file-earmark-arrow-down"></i></div>
            <span class="card-title">Formaty eksportu</span>
            <span class="card-badge badge-req">WYMAGANE</span>
            <i class="bi bi-chevron-down collapse-chevron ms-auto"></i>
          </div>
          <div class="card-body" id="fmtContainer">
            <!-- PDF -->
            <div class="fmt-card">
              <div class="fmt-head" onclick="toggleFmt(this)">
                <div class="fmt-ico fmt-pdf"><i class="bi bi-filetype-pdf"></i></div>
                <span class="fmt-name">PDF</span>
                <div style="display:flex;align-items:center;gap:6px;margin-left:auto" onclick="event.stopPropagation()">
                  <label class="toggle-sw" style="width:32px;height:18px"><input class="fmt-cb" id="fmtPdfEnabled" type="checkbox" checked onchange="onFieldChange(this)"><div class="toggle-track"><div class="toggle-thumb" style="width:12px;height:12px;top:3px;left:3px"></div></div></label>
                  <span style="font-size:12px;font-weight:600;color:var(--muted)">Aktywny</span>
                </div>
                <i class="bi bi-chevron-down fmt-chevron ms-2"></i>
              </div>
              <div class="fmt-body open">
                <div class="form-row auto">
                  <div class="field"><label class="field-label">Orientacja <i class="tip-btn">?<span class="tip-popup">Auto = CR dobiera wg szeroko≈õci. Landscape dla szerokich tabel.</span></i></label><select class="fs"><option>Portrait</option><option>Landscape</option><option>Auto</option></select></div>
                  <div class="field"><label class="field-label">Papier</label><select class="fs"><option>A4</option><option>A3</option><option>Letter</option><option>Legal</option></select></div>
                  <div class="field"><label class="field-label">Marginesy G/P/D/L (mm) <i class="tip-btn">?<span class="tip-popup">CR: File ‚Üí Page Setup ‚Üí Margins. Standard: 10/10/10/10.</span></i></label><input type="text" class="fc" placeholder="10/10/10/10"/></div>
                  <div class="field"><label class="field-label">Wersja PDF <i class="tip-btn">?<span class="tip-popup">PDF/A-1b = standard archiwizacyjny wymagany w administracji publicznej. Wymaga osadzenia czcionek.</span></i></label><select class="fs"><option>PDF 1.4 (domy≈õlny CR)</option><option>PDF/A-1b (archiwizacja)</option><option>PDF/A-2</option></select></div>
                  <div class="field"><label class="field-label">DPI <i class="tip-btn">?<span class="tip-popup">96=ekran, 300=druk, 600=druk profesjonalny. Dla tekstowych raport√≥w 150 DPI wystarczy.</span></i></label><select class="fs"><option>96 DPI</option><option>150 DPI</option><option>300 DPI</option><option>600 DPI</option></select></div>
                  <div class="field"><label class="field-label">Wzorzec nazwy <i class="tip-btn">?<span class="tip-popup">Programista interpoluje tokeny w C# przed ExportToStream.</span></i></label><input type="text" class="fc mono" id="pdfFilePattern" placeholder="Raport_{?MiesiƒÖc}_{PrintDate}.pdf" minlength="5" pattern=".*\.pdf$" oninput="onFieldChange(this)"/></div>
                </div>
              </div>
            </div>
            <!-- Excel -->
            <div class="fmt-card">
              <div class="fmt-head" onclick="toggleFmt(this)">
                <div class="fmt-ico fmt-xls"><i class="bi bi-filetype-xlsx"></i></div>
                <span class="fmt-name">Excel (.xlsx)</span>
                <div style="display:flex;align-items:center;gap:6px;margin-left:auto" onclick="event.stopPropagation()">
                  <label class="toggle-sw" style="width:32px;height:18px"><input class="fmt-cb" id="fmtExcelEnabled" type="checkbox" onchange="onFieldChange(this)"><div class="toggle-track"><div class="toggle-thumb" style="width:12px;height:12px;top:3px;left:3px"></div></div></label>
                  <span style="font-size:12px;font-weight:600;color:var(--muted)">Aktywny</span>
                </div>
                <i class="bi bi-chevron-down fmt-chevron ms-2"></i>
              </div>
              <div class="fmt-body">
                <div class="form-row auto">
                  <div class="field"><label class="field-label">Format Excel <i class="tip-btn">?<span class="tip-popup">Data Only = surowe dane bez formatowania CR ‚Äî lepsza edytowalno≈õƒá w Excel.</span></i></label><select class="fs"><option>XLSX</option><option>XLSX Data Only</option><option>XLS</option></select></div>
                  <div class="field"><label class="field-label">Arkusz</label><input type="text" class="fc" placeholder="Dane lub {?MiesiƒÖc}"/></div>
                  <div class="field"><label class="field-label">Wzorzec nazwy</label><input type="text" class="fc mono" id="excelFilePattern" placeholder="Raport_{PrintDate}.xlsx" minlength="5" pattern=".*\.xlsx?$" oninput="onFieldChange(this)"/></div>
                </div>
                <div class="form-row cols-3" style="margin-top:10px">
                  <div class="toggle-row"><label class="toggle-sw"><input type="checkbox" checked><div class="toggle-track"><div class="toggle-thumb"></div></div></label><span class="toggle-label">AutoFilter <i class="tip-btn" style="vertical-align:middle">?<span class="tip-popup">Rozwijane filtry Excel. Implementacja przez EPPlus/ClosedXML po eksporcie CR.</span></i></span></div>
                  <div class="toggle-row"><label class="toggle-sw"><input type="checkbox"><div class="toggle-track"><div class="toggle-thumb"></div></div></label><span class="toggle-label">Freeze nag≈Ç√≥wka <i class="tip-btn" style="vertical-align:middle">?<span class="tip-popup">Freeze Pane = zamro≈ºenie pierwszego wiersza. EPPlus v5+.</span></i></span></div>
                </div>
              </div>
            </div>
            <!-- CSV -->
            <div class="fmt-card">
              <div class="fmt-head" onclick="toggleFmt(this)">
                <div class="fmt-ico fmt-csv"><i class="bi bi-filetype-csv"></i></div>
                <span class="fmt-name">CSV / Tekst</span>
                <div style="display:flex;align-items:center;gap:6px;margin-left:auto" onclick="event.stopPropagation()">
                  <label class="toggle-sw" style="width:32px;height:18px"><input class="fmt-cb" id="fmtCsvEnabled" type="checkbox" onchange="onFieldChange(this)"><div class="toggle-track"><div class="toggle-thumb" style="width:12px;height:12px;top:3px;left:3px"></div></div></label>
                  <span style="font-size:12px;font-weight:600;color:var(--muted)">Aktywny</span>
                </div>
                <i class="bi bi-chevron-down fmt-chevron ms-2"></i>
              </div>
              <div class="fmt-body">
                <div class="form-row auto">
                  <div class="field"><label class="field-label">Separator <i class="tip-btn">?<span class="tip-popup">≈örednik (;) = standard PL Excel. Przecinek (,) = EN. Tabulator dla legacy.</span></i></label><select class="fs"><option>≈örednik (;)</option><option>Przecinek (,)</option><option>Tabulator (\t)</option><option>Pionowa kreska (|)</option></select></div>
                  <div class="field"><label class="field-label">Encoding <i class="tip-btn">?<span class="tip-popup">UTF-8 BOM = zalecane dla polskich znak√≥w w Excel. BOM = Excel wykrywa kodowanie automatycznie.</span></i></label><select class="fs"><option>UTF-8 BOM</option><option>UTF-8</option><option>Windows-1250</option></select></div>
                  <div class="field"><label class="field-label">Format daty</label><input type="text" class="fc" placeholder="yyyy-MM-dd"/></div>
                  <div class="field"><label class="field-label">Wzorzec nazwy</label><input type="text" class="fc mono" id="csvFilePattern" placeholder="Raport_{PrintDate}.csv" minlength="5" pattern=".*\.csv$" oninput="onFieldChange(this)"/></div>
                </div>
              </div>
            </div>
            <button class="btn-add mt-3" onclick="addFmtCard()"><i class="bi bi-plus-lg"></i>Dodaj format</button>
          </div>
        </div>

        <div class="card card-nth-2">
          <div class="card-head collapsible" onclick="toggleCard(this)">
            <div class="card-ico ci-green"><i class="bi bi-gear"></i></div>
            <span class="card-title">Og√≥lne opcje dostarczania</span>
            <i class="bi bi-chevron-down collapse-chevron ms-auto"></i>
          </div>
          <div class="card-body">
            <div class="form-row cols-3">
              <div class="field"><label class="field-label">Domy≈õlny format <span class="req-star">*</span></label><select class="fs" id="defaultExportFormat" required onchange="onFieldChange(this)"><option value="">‚Äî wybierz ‚Äî</option><option>PDF</option><option>Excel</option><option>CSV</option></select></div>
              <div class="field"><label class="field-label">Widoczno≈õƒá <i class="tip-btn">?<span class="tip-popup">PodglƒÖd = CrystalReportViewer w Razor Page. Tylko eksport = bezpo≈õrednie pobranie bez podglƒÖdu.</span></i></label><select class="fs"><option>PodglƒÖd w przeglƒÖdarce</option><option>Tylko eksport</option><option>Oba tryby</option></select></div>
              <div class="field"><label class="field-label">Harmonogram <i class="tip-btn">?<span class="tip-popup">Automatyczne generowanie. Wymaga Hangfire, Quartz.NET lub Windows Scheduler.</span></i></label><select class="fs"><option>Na ≈ºƒÖdanie</option><option>Codziennie</option><option>Co tydzie≈Ñ</option><option>Ostatni dzie≈Ñ miesiƒÖca</option><option>Niestandardowy (CRON)</option></select></div>
            </div>
          </div>
        </div>

        <div class="nav-actions">
          <button class="btn-secondary" onclick="goTab('t9')"><i class="bi bi-arrow-left"></i> Wr√≥ƒá</button>
          <button class="btn-primary" onclick="toggleSummary();showToast('Definicja gotowa! Sprawd≈∫ podsumowanie.','success')"><i class="bi bi-check-circle"></i>Zako≈Ñcz i podglƒÖd</button>
        </div>
      </div>

      </div><!-- end .tab-content -->
    </form>
  </main>

  <!-- ‚ïê‚ïê‚ïê SUMMARY PANEL ‚ïê‚ïê‚ïê -->
  <button class="summary-backdrop" id="summaryBackdrop" type="button" onclick="toggleSummary(false)" aria-label="Zamknij podsumowanie"></button>
  <aside class="summary-panel" id="summaryPanel">
    <div class="sum-panel-head">
      <span class="sum-panel-title"><i class="bi bi-clipboard-data me-2"></i>Podsumowanie</span>
      <div class="sum-panel-head-actions">
        <label class="sum-compact-toggle" for="summaryCompactToggle">
          <input id="summaryCompactToggle" type="checkbox" onchange="setSummaryCompact(this.checked)">
          <span>Tryb kompaktowy</span>
        </label>
        <button class="sum-panel-close" data-summary-toggle onclick="toggleSummary()"><i class="bi bi-x-lg"></i></button>
      </div>
    </div>
    <div class="sum-panel-body" id="sumPanelBody">
      <div class="sum-score">
        <div class="score-ring">
          <svg width="90" height="90" viewBox="0 0 90 90">
            <circle cx="45" cy="45" r="38" fill="none" stroke="#e2e8f0" stroke-width="8"/>
            <circle id="scoreCircle" cx="45" cy="45" r="38" fill="none" stroke="url(#scoreGrad)" stroke-width="8" stroke-linecap="round" stroke-dasharray="239" stroke-dashoffset="239"/>
            <defs>
              <linearGradient id="scoreGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" stop-color="#2563eb"/>
                <stop offset="100%" stop-color="#059669"/>
              </linearGradient>
            </defs>
          </svg>
          <div class="score-pct"><span class="pct-num" id="scorePct">0%</span><span class="pct-lbl">gotowe</span></div>
        </div>
        <div class="score-status-txt" id="scoreStatusTxt" style="color:var(--muted)">Uzupe≈Çnij pola aby ≈õledziƒá postƒôp</div>
      </div>

      <div class="sum-section" id="sumSectionTabs">
        <button class="sum-accordion-btn" type="button" onclick="toggleSummarySection('sumSectionTabs')">
          <span>Zak≈Çadki</span><i class="bi bi-chevron-down"></i>
        </button>
        <div class="sum-section-body">
          <div id="sumTabList"></div>
          <div class="sum-detail" style="margin-top:8px">
            <div class="sum-detail-label">Szybkie akcje</div>
            <div class="sum-detail-val" style="display:flex;gap:8px;flex-wrap:wrap">
              <button class="tchip" type="button" onclick="goTab('t1');toggleSummary(false)"><i class="bi bi-pencil-square"></i> Edytuj metadane</button>
              <button class="tchip g" type="button" onclick="goTab('t10');toggleSummary(false)"><i class="bi bi-filetype-pdf"></i> Eksport</button>
            </div>
          </div>
        </div>
      </div>

      <div class="sum-section" id="sumSectionDetails">
        <button class="sum-accordion-btn" type="button" onclick="toggleSummarySection('sumSectionDetails')">
          <span>Szczeg√≥≈Çy</span><i class="bi bi-chevron-down"></i>
        </button>
        <div class="sum-section-body">
          <div id="sumDetails"></div>
        </div>
      </div>

      <div class="sum-section" id="sumSectionAlerts">
        <button class="sum-accordion-btn" type="button" onclick="toggleSummarySection('sumSectionAlerts')">
          <span>Alerty</span><i class="bi bi-chevron-down"></i>
        </button>
        <div class="sum-section-body">
          <div id="sumAlerts"></div>
        </div>
      </div>

      <div style="margin-top:14px;display:flex;flex-direction:column;gap:8px">
        <button class="btn-primary" id="generateDocumentationBtn" type="button" style="width:100%;justify-content:center" onclick="validateBeforeSubmit()"><i class="bi bi-file-earmark-text"></i>Generuj dokumentacjƒô</button>
        <button class="btn-secondary" style="width:100%;justify-content:center" onclick="showToast('Dane skopiowane!','success')"><i class="bi bi-clipboard"></i>Kopiuj jako JSON</button>
      </div>
    </div>
  </aside>

</div><!-- end .shell -->

<!-- ‚ïê‚ïê‚ïê FOOTER BAR ‚ïê‚ïê‚ïê -->
<div class="footer-bar" id="footerBar">
  <div class="footer-info">
    <span class="footer-step" id="footerStep">01</span>
    <span id="footerStepName">Informacje og√≥lne</span>
  </div>
  <div class="footer-actions">
    <button class="tb-btn" onclick="toggleSidebar()"><i class="bi bi-layout-sidebar"></i></button>
    <button class="tb-btn" data-summary-toggle onclick="toggleSummary()"><i class="bi bi-panel-split"></i><span>Podsumowanie</span></button>
    <button class="tb-btn" id="quickFixCta" style="display:none" onclick="topPriorityError && goToField(topPriorityError.tab, topPriorityError.fieldId)"><i class="bi bi-magic"></i><span>Przejd≈∫ i popraw</span></button>
    <button class="btn-primary" onclick="showToast('Szkic zapisany!','success')"><i class="bi bi-save"></i><span>Zapisz</span></button>
  </div>
</div>

<div id="globalTip" class="global-tip" aria-hidden="true"></div>

<!-- ‚ïê‚ïê‚ïê TOAST CONTAINER ‚ïê‚ïê‚ïê -->
<div class="toast-container" id="toastContainer"></div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê JAVASCRIPT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script src="data.js"></script>
<script src="app.js"></script>
</body>
</html>
