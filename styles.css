@import url('https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=JetBrains+Mono:ital,wght@0,400;0,500;1,400&family=Epilogue:wght@400;500;600;700&display=swap');

/* ══════════ CSS VARS ══════════ */
:root{
  --bg:#f0f2f8;
  --bg2:#e8ebf4;
  --surface:#ffffff;
  --surface2:#f6f7fb;
  --surface3:#eceef6;
  --border:#d8dce8;
  --border2:#c5cadc;
  --a:#2563eb;          /* blue accent */
  --a-l:#dbeafe;
  --a-d:#1d4ed8;
  --g:#059669;          /* green - complete */
  --g-l:#d1fae5;
  --y:#d97706;          /* yellow - partial */
  --y-l:#fef3c7;
  --r:#dc2626;          /* red/danger */
  --r-l:#fee2e2;
  --txt:#0f172a;
  --txt2:#334155;
  --muted:#64748b;
  --color-success-bg:var(--g-l);
  --color-warning-bg:var(--y-l);
  --color-info-bg:var(--a-l);
  --surface-elevated:linear-gradient(135deg,var(--a),var(--a-d));
  --surface-overlay:var(--txt);
  --sidebar-w:260px;
  --sidebar-collapsed:64px;
  --summary-w:320px;
  --topbar-h:56px;
  --radius:12px;
  --radius-sm:8px;
  --shadow:0 1px 3px rgba(15,23,42,.06),0 4px 12px rgba(15,23,42,.04);
  --shadow-md:0 4px 20px rgba(37,99,235,.1),0 1px 4px rgba(37,99,235,.06);
  --shadow-lg:0 20px 60px rgba(15,23,42,.15);
  --trans:.22s cubic-bezier(.4,0,.2,1);
  --bounce:.35s cubic-bezier(.34,1.56,.64,1);
}

body.theme-dark{
  --bg:#0b1220;
  --bg2:#10192b;
  --surface:#111827;
  --surface2:#1f2937;
  --surface3:#0f172a;
  --border:#334155;
  --border2:#475569;
  --a:#60a5fa;
  --a-l:#1e3a8a;
  --a-d:#3b82f6;
  --g:#34d399;
  --g-l:#064e3b;
  --y:#f59e0b;
  --y-l:#78350f;
  --r:#f87171;
  --r-l:#7f1d1d;
  --txt:#e2e8f0;
  --txt2:#cbd5e1;
  --muted:#94a3b8;
  --color-success-bg:#064e3b;
  --color-warning-bg:#78350f;
  --color-info-bg:#1e3a8a;
  --surface-elevated:linear-gradient(135deg,#60a5fa,#3b82f6);
  --surface-overlay:#020617;
  --shadow:0 1px 3px rgba(0,0,0,.35),0 4px 12px rgba(0,0,0,.25);
  --shadow-md:0 8px 24px rgba(0,0,0,.38);
  --shadow-lg:0 20px 60px rgba(0,0,0,.5);
}

/* ══════════ RESET & BASE ══════════ */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
html{scroll-behavior:smooth;}
body{
  background:var(--bg);
  color:var(--txt);
  font-family:'Epilogue',sans-serif;
  font-size:14px;
  min-height:100vh;
  overflow-x:hidden;
  -webkit-font-smoothing:antialiased;
}

/* ══════════ PAGE LOAD ANIMATION ══════════ */
@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:none}}
@keyframes slideInLeft{from{opacity:0;transform:translateX(-30px)}to{opacity:1;transform:none}}
@keyframes slideInRight{from{opacity:0;transform:translateX(30px)}to{opacity:1;transform:none}}
@keyframes scaleIn{from{opacity:0;transform:scale(.92)}to{opacity:1;transform:none}}
@keyframes pulseGlow{0%,100%{box-shadow:0 0 0 0 rgba(37,99,235,.3)}50%{box-shadow:0 0 0 8px rgba(37,99,235,0)}}
@keyframes shimmer{from{background-position:200% 0}to{background-position:-200% 0}}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes checkPop{0%{transform:scale(0) rotate(-45deg);opacity:0}60%{transform:scale(1.2) rotate(5deg)}100%{transform:scale(1) rotate(0);opacity:1}}
@keyframes dotPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.4)}}
@keyframes toastIn{from{opacity:0;transform:translateY(20px) scale(.9)}to{opacity:1;transform:none}}
@keyframes toastOut{from{opacity:1;transform:none}to{opacity:0;transform:translateY(-10px) scale(.95)}}
@keyframes tabPaneFade{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:none}}
@keyframes progressFill{from{width:0}to{width:var(--target-width,0%)}}

/* ══════════ TOPBAR ══════════ */
.topbar{
  position:fixed;top:0;left:0;right:0;z-index:200;
  height:var(--topbar-h);
  background:rgba(255,255,255,.92);
  backdrop-filter:blur(16px);
  -webkit-backdrop-filter:blur(16px);
  border-bottom:1px solid var(--border);
  display:flex;align-items:center;gap:0;
  box-shadow:var(--shadow);
  animation:fadeUp .4s ease both;
}
.topbar-brand{
  display:flex;align-items:center;gap:10px;
  padding:0 20px;height:100%;
  border-right:1px solid var(--border);
  min-width:var(--sidebar-w);
  transition:min-width var(--trans);
  text-decoration:none;
}
.body-sidebar-collapsed .topbar-brand{min-width:var(--sidebar-collapsed);}
.brand-logo{
  width:32px;height:32px;flex-shrink:0;
  background:linear-gradient(135deg,var(--a) 0%,#7c3aed 100%);
  border-radius:9px;display:grid;place-items:center;
  color:#fff;font-size:15px;
  box-shadow:0 4px 12px rgba(37,99,235,.35);
}
.brand-text{
  font-family:'Syne',sans-serif;font-size:16px;font-weight:800;
  color:var(--txt);letter-spacing:-.5px;white-space:nowrap;
  overflow:hidden;transition:opacity var(--trans),max-width var(--trans);
}
.brand-text span{color:var(--a);}
.body-sidebar-collapsed .brand-text{max-width:0;opacity:0;overflow:hidden;}
.topbar-center{flex:1;display:flex;align-items:center;padding:0 20px;gap:14px;}

/* Global progress bar in topbar */
.global-progress{
  flex:1;max-width:340px;
  background:var(--surface3);border-radius:20px;height:6px;overflow:hidden;
  position:relative;
}
.global-progress-fill{
  height:100%;border-radius:20px;
  background:linear-gradient(90deg,var(--a),#7c3aed,var(--g));
  background-size:200% 100%;
  animation:shimmer 3s linear infinite;
  transition:width .6s cubic-bezier(.4,0,.2,1);
  position:relative;
}
.global-progress-fill::after{
  content:'';position:absolute;right:0;top:50%;transform:translateY(-50%);
  width:10px;height:10px;border-radius:50%;
  background:#fff;border:2px solid var(--a);
  box-shadow:0 0 0 3px rgba(37,99,235,.2);
}
.progress-label{font-size:12px;font-weight:700;color:var(--muted);white-space:nowrap;font-family:'JetBrains Mono',monospace;}

.topbar-right{display:flex;align-items:center;gap:8px;padding-right:16px;}
.theme-switch{
  display:flex;align-items:center;
  border:1.5px solid var(--border);
  border-radius:999px;
  padding:2px;
  background:var(--surface2);
}
.theme-switch-btn{
  border:none;
  background:transparent;
  color:var(--muted);
  border-radius:999px;
  padding:6px 10px;
  font-size:12px;
  font-weight:700;
  display:flex;align-items:center;gap:6px;
  cursor:pointer;
}
.theme-switch-btn.active{
  background:var(--surface-elevated);
  color:#fff;
}
.tb-btn{
  display:flex;align-items:center;gap:6px;
  padding:7px 14px;border-radius:var(--radius-sm);
  font-size:12.5px;font-weight:600;cursor:pointer;
  transition:all var(--trans);border:1.5px solid var(--border);
  background:var(--surface2);color:var(--muted);
  font-family:'Epilogue',sans-serif;
  white-space:nowrap;
}
.tb-btn:hover{border-color:var(--a);color:var(--a);background:var(--a-l);transform:translateY(-1px);}
.tb-btn.primary{
  background:linear-gradient(135deg,var(--a),var(--a-d));
  color:#fff;border-color:transparent;
  box-shadow:0 4px 12px rgba(37,99,235,.3);
}
.tb-btn.primary:hover{box-shadow:0 6px 20px rgba(37,99,235,.4);transform:translateY(-2px);}

/* Sidebar toggle btn */
.sidebar-toggle{
  width:36px;height:36px;border-radius:var(--radius-sm);
  background:none;border:1.5px solid var(--border);
  color:var(--muted);cursor:pointer;
  display:grid;place-items:center;font-size:14px;
  transition:all var(--trans);flex-shrink:0;margin-left:4px;
}
.sidebar-toggle:hover{background:var(--a-l);border-color:var(--a);color:var(--a);}

/* Summary toggle btn with glow */
.summary-toggle-btn{
  position:relative;
}
.summary-toggle-btn::before{
  content:'';position:absolute;inset:-3px;border-radius:12px;
  background:linear-gradient(135deg,var(--a),#7c3aed);
  opacity:0;z-index:-1;transition:opacity var(--trans);
}
.summary-toggle-btn.active::before{opacity:.2;}

/* ══════════ LAYOUT SHELL ══════════ */
.shell{
  display:flex;
  margin-top:var(--topbar-h);
  min-height:calc(100vh - var(--topbar-h));
  transition:all var(--trans);
}

/* ══════════ SIDEBAR NAV ══════════ */
.sidebar{
  width:var(--sidebar-w);
  flex-shrink:0;
  background:var(--surface);
  border-right:1px solid var(--border);
  position:fixed;
  top:var(--topbar-h);bottom:0;left:0;
  overflow:hidden;
  transition:width var(--trans);
  z-index:150;
  display:flex;flex-direction:column;
  box-shadow:2px 0 12px rgba(15,23,42,.04);
  animation:slideInLeft .4s .1s ease both;
}
.body-sidebar-collapsed .sidebar{width:var(--sidebar-collapsed);}
.sidebar-inner{
  flex:1;overflow-y:auto;overflow-x:hidden;
  padding:12px 8px;
  scrollbar-width:thin;scrollbar-color:var(--border) transparent;
}
.sidebar-section-label{
  font-family:'Syne',sans-serif;
  font-size:9px;font-weight:700;letter-spacing:1.2px;
  text-transform:uppercase;color:var(--muted);
  padding:10px 10px 4px;white-space:nowrap;
  overflow:hidden;
  transition:opacity var(--trans);
}
.body-sidebar-collapsed .sidebar-section-label{opacity:0;}

/* TAB BUTTON */
.tab-btn{
  display:flex;align-items:center;gap:10px;
  padding:9px 10px;border-radius:10px;
  cursor:pointer;transition:all var(--trans);
  font-size:13px;font-weight:600;color:var(--muted);
  border:none;background:none;width:100%;text-align:left;
  position:relative;overflow:hidden;white-space:nowrap;
  font-family:'Epilogue',sans-serif;
  margin-bottom:2px;
}
.tab-btn::before{
  content:'';position:absolute;inset:0;border-radius:10px;
  background:linear-gradient(135deg,var(--a),#7c3aed);
  opacity:0;transition:opacity var(--trans);
}
.tab-btn.active{color:#fff;}
.tab-btn.active::before{opacity:1;}
.tab-btn:not(.active):hover{background:var(--surface2);color:var(--txt);}

.tab-ico{
  width:28px;height:28px;border-radius:7px;
  display:grid;place-items:center;font-size:13px;
  flex-shrink:0;transition:all var(--trans);
  position:relative;z-index:1;
}
.tab-btn:not(.active) .tab-ico{background:var(--surface3);color:var(--muted);}
.tab-btn.active .tab-ico{background:rgba(255,255,255,.2);color:#fff;}

.tab-label{position:relative;z-index:1;flex:1;overflow:hidden;text-overflow:ellipsis;}

/* STATUS DOT — completion indicator */
.tab-status{
  width:8px;height:8px;border-radius:50%;
  flex-shrink:0;position:relative;z-index:1;
  transition:all var(--bounce);
}
.tab-status.none{background:var(--border2);}
.tab-status.partial{background:var(--y);animation:dotPulse 2s ease-in-out infinite;}
.tab-status.complete{background:var(--g);}
.tab-btn.active .tab-status.none{background:rgba(255,255,255,.35);}
.tab-btn.active .tab-status.partial{background:#fbbf24;}
.tab-btn.active .tab-status.complete{background:#34d399;}

/* Collapsed: show only icon + status */
.body-sidebar-collapsed .tab-label,
.body-sidebar-collapsed .sidebar-section-label{
  max-width:0;opacity:0;overflow:hidden;
}
.body-sidebar-collapsed .tab-btn{justify-content:center;padding:9px;}
.body-sidebar-collapsed .tab-status{
  position:absolute;top:6px;right:6px;width:7px;height:7px;
}

/* Sidebar tooltip on hover when collapsed */
.body-sidebar-collapsed .tab-btn:hover .tab-label{
  max-width:none;opacity:1;
  position:absolute;left:56px;
  background:var(--txt);color:#fff;
  padding:5px 10px;border-radius:8px;
  font-size:12px;
  pointer-events:none;
  white-space:nowrap;z-index:999;
  animation:fadeUp .15s ease;
  box-shadow:var(--shadow-md);
}

/* Sidebar footer */
.sidebar-footer{
  padding:10px 8px;border-top:1px solid var(--border);
  display:flex;flex-direction:column;gap:6px;
}
.sidebar-footer-btn{
  display:flex;align-items:center;gap:8px;
  padding:8px 10px;border-radius:8px;
  font-size:12.5px;font-weight:600;cursor:pointer;
  transition:all var(--trans);border:none;background:none;
  color:var(--muted);width:100%;white-space:nowrap;
  font-family:'Epilogue',sans-serif;
}
.sidebar-footer-btn:hover{background:var(--surface2);color:var(--txt);}
.sidebar-footer-btn i{font-size:15px;flex-shrink:0;width:28px;text-align:center;}
.body-sidebar-collapsed .sidebar-footer-btn{justify-content:center;padding:8px;}

/* ══════════ MAIN CONTENT ══════════ */
.main{
  flex:1;
  margin-left:var(--sidebar-w);
  margin-right:0;
  transition:margin var(--trans);
  min-width:0;
}
.body-sidebar-collapsed .main{margin-left:var(--sidebar-collapsed);}

.tab-content{
  padding:28px 32px 100px;
  max-width:1100px;
  margin:0 auto;
}

.quick-actions{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin:0 auto 14px;
  max-width:1100px;
  padding:0 32px;
}
.quick-action-chip{
  display:inline-flex;
  align-items:center;
  gap:8px;
  border:none;
  border-radius:999px;
  padding:8px 14px;
  font-size:12px;
  font-weight:700;
  cursor:pointer;
  transition:transform var(--trans),filter var(--trans),box-shadow var(--trans);
  box-shadow:var(--shadow);
}
.quick-action-chip i{font-size:13px;}
.quick-action-chip:hover{transform:translateY(-1px);filter:brightness(.98);}
.quick-action-chip:focus-visible{outline:2px solid var(--a);outline-offset:2px;}
.quick-action-chip.lightning{background:var(--a-l);color:var(--a);}
.quick-action-chip.warning{background:var(--y-l);color:var(--y);}
.quick-action-chip.success{background:var(--g-l);color:var(--g);}

/* Tab pane animation */
.tab-pane{display:none;}
.tab-pane.active{
  display:block;
  animation:tabPaneFade .3s ease both;
}

/* ══════════ SUMMARY PANEL ══════════ */
.summary-panel{
  position:fixed;top:var(--topbar-h);right:0;bottom:0;
  width:var(--summary-w);
  background:var(--surface);
  border-left:1px solid var(--border);
  transform:translateX(100%);
  opacity:0;
  pointer-events:none;
  will-change:transform,opacity;
  z-index:260;
  display:flex;flex-direction:column;
  box-shadow:-4px 0 24px rgba(15,23,42,.08);
}
.body-summary-open .summary-panel{
  transform:translateX(0);
  opacity:1;
  pointer-events:auto;
  animation:summaryPanelIn .24s cubic-bezier(.2,.7,.2,1) both;
}
.body-summary-closing .summary-panel{
  transform:translateX(100%);
  opacity:0;
  pointer-events:none;
  animation:summaryPanelOut .2s cubic-bezier(.4,0,.2,1) both;
}
.summary-backdrop{
  position:fixed;
  inset:var(--topbar-h) 0 0;
  background:rgba(15,23,42,.3);
  opacity:0;
  pointer-events:none;
  transition:opacity var(--trans);
  z-index:250;
}
.body-summary-open .summary-backdrop{
  opacity:1;
  pointer-events:auto;
}
.body-summary-closing .summary-backdrop{
  opacity:0;
  pointer-events:none;
}
.sum-panel-head{
  padding:16px 18px;border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;
  background:var(--surface2);
  flex-shrink:0;
  position:relative;
}
.sum-panel-head-actions{display:flex;align-items:center;gap:10px;}
.sum-panel-title{font-family:'Syne',sans-serif;font-size:14px;font-weight:800;color:var(--txt);}
.sum-compact-toggle{display:flex;align-items:center;gap:6px;font-size:11px;font-weight:700;color:var(--muted);}
.sum-compact-toggle input{accent-color:var(--a);}
.sum-panel-close{
  width:28px;height:28px;border-radius:6px;
  background:none;border:none;cursor:pointer;
  color:var(--muted);font-size:14px;
  display:grid;place-items:center;
  transition:all var(--trans);
}
.sum-panel-close:hover{background:var(--r-l);color:var(--r);}
.sum-panel-body{
  flex:1;overflow-y:auto;padding:14px;
  scrollbar-width:thin;scrollbar-color:var(--border) transparent;
}

/* Summary score ring */
.sum-score{
  display:flex;flex-direction:column;align-items:center;
  padding:18px 0 14px;
}
.score-ring{position:relative;width:90px;height:90px;}
.score-ring svg{transform:rotate(-90deg);}
.score-ring circle{transition:stroke-dashoffset .8s cubic-bezier(.4,0,.2,1);}
.score-pct{
  position:absolute;inset:0;display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  font-family:'Syne',sans-serif;
}
.score-pct .pct-num{font-size:20px;font-weight:800;color:var(--txt);}
.score-pct .pct-lbl{font-size:9px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;}
.score-status-txt{font-size:12px;font-weight:700;margin-top:8px;}

/* Summary tab checklist */
.sum-tab-row{
  display:flex;align-items:center;gap:8px;
  padding:8px 10px;border-radius:8px;
  margin-bottom:4px;cursor:pointer;
  transition:all var(--trans);
}
.sum-tab-row:hover{background:var(--surface2);}
.sum-tab-ico{width:22px;height:22px;border-radius:5px;display:grid;place-items:center;font-size:10px;flex-shrink:0;}
.sum-ico-g{background:var(--g-l);color:var(--g);}
.sum-ico-y{background:var(--y-l);color:var(--y);}
.sum-ico-n{background:var(--surface3);color:var(--muted);}
.sum-tab-name{font-size:12.5px;font-weight:600;flex:1;color:var(--txt2);}
.sum-tab-pct{font-size:11px;font-family:'JetBrains Mono',monospace;font-weight:500;color:var(--muted);}
.sum-tab-meta{font-size:10px;color:var(--muted);margin-top:2px;display:block;}
.compact-hidden{display:none;}

.sum-divider{border:none;border-top:1px solid var(--border);margin:12px 0;}
.sum-section{margin-bottom:10px;}
.sum-accordion-btn{
  width:100%;display:flex;align-items:center;justify-content:space-between;gap:8px;
  border:1px solid var(--border);background:var(--surface2);color:var(--txt2);
  border-radius:8px;padding:8px 10px;cursor:pointer;font-size:10px;font-weight:800;
  letter-spacing:.8px;text-transform:uppercase;transition:all var(--trans);
}
.sum-accordion-btn:hover{border-color:var(--a);color:var(--a);}
.sum-accordion-btn .bi{font-size:12px;transition:transform var(--trans);}
.sum-section.collapsed .sum-accordion-btn .bi{transform:rotate(-90deg);}
.sum-section-body{padding-top:8px;}
.sum-section.collapsed .sum-section-body{display:none;}

/* Summary detail items */
.sum-detail{background:var(--surface2);border-radius:8px;padding:10px 12px;margin-bottom:6px;}
.sum-detail-label{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;color:var(--muted);}
.sum-detail-val{font-size:13px;font-weight:700;color:var(--txt);margin-top:3px;}
.sum-detail-val.empty{color:var(--muted);font-weight:400;font-style:italic;font-size:12px;}

/* Alert items */
.sum-alert{display:flex;gap:7px;padding:8px 10px;border-radius:7px;font-size:11.5px;line-height:1.5;margin-bottom:5px;}
.sum-alert.warn{background:var(--color-warning-bg);color:var(--y);}
.sum-alert.ok{background:var(--color-success-bg);color:var(--g);}
.sum-alert i{flex-shrink:0;font-size:13px;margin-top:1px;}
.sum-priority-wrap{display:flex;flex-direction:column;gap:6px;margin-bottom:8px;}
.sum-priority{background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:8px 10px;display:flex;flex-direction:column;gap:6px;}
.sum-priority-title{font-size:11px;font-weight:800;color:var(--txt);line-height:1.35;}
.sum-priority-body{font-size:11.5px;color:var(--txt2);line-height:1.45;}
.sum-priority-cta{display:inline-flex;align-items:center;gap:6px;width:max-content;padding:5px 8px;border-radius:999px;border:1px solid var(--a);background:var(--a-l);color:var(--a);font-size:11px;font-weight:700;cursor:pointer;}
.sum-priority-cta:hover{background:#dbeafe;}
.sum-priority-rules{margin-top:7px;padding:7px 10px;border-radius:8px;background:var(--surface2);border:1px dashed var(--border2);}
.sum-priority-rules ul{margin:5px 0 0 16px;padding:0;}
.sum-priority-rules li{font-size:10.8px;color:var(--muted);line-height:1.45;}

.sum-badge{display:inline-block;font-size:10.5px;font-weight:700;padding:2px 8px;border-radius:20px;margin:2px 2px 0 0;}
.sum-badge.blue{background:var(--a-l);color:var(--a);}
.sum-badge.green{background:var(--g-l);color:var(--g);}
.sum-badge.yellow{background:var(--y-l);color:var(--y);}

/* ══════════ PAGE HEADER ══════════ */
.page-header{margin-bottom:24px;animation:fadeUp .3s ease both;}
.page-header h1{
  font-family:'Syne',sans-serif;
  font-size:26px;font-weight:800;color:var(--txt);letter-spacing:-.6px;
  position:relative;display:inline-block;
}
.page-header h1::after{
  content:'';position:absolute;bottom:-4px;left:0;right:0;height:3px;
  background:linear-gradient(90deg,var(--a),#7c3aed);border-radius:2px;
  transform:scaleX(0);transform-origin:left;
  animation:scaleX .5s .2s ease forwards;
}
@keyframes scaleX{to{transform:scaleX(1)}}
.page-header p{font-size:13px;color:var(--muted);margin-top:10px;line-height:1.6;}

/* Step indicator */
.step-indicator{
  display:flex;align-items:center;gap:4px;
  font-family:'JetBrains Mono',monospace;
  font-size:11px;color:var(--muted);
  margin-bottom:6px;font-weight:500;
}
.step-dot{width:6px;height:6px;border-radius:50%;background:var(--a);}

/* ══════════ CARDS ══════════ */
.card{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  margin-bottom:18px;
  overflow:visible;
  transition:box-shadow var(--trans),transform var(--trans);
  animation:fadeUp .3s ease both;
}
.card:hover{box-shadow:var(--shadow-md);}
.card-nth-1{animation-delay:.05s}
.card-nth-2{animation-delay:.1s}
.card-nth-3{animation-delay:.15s}
.card-nth-4{animation-delay:.2s}

.card-head{
  padding:13px 18px;
  border-bottom:1px solid var(--border);
  display:flex;align-items:center;gap:10px;
  background:var(--surface2);
}
.card-ico{
  width:30px;height:30px;border-radius:7px;
  display:grid;place-items:center;font-size:13px;flex-shrink:0;
}
.ci-blue{background:var(--a-l);color:var(--a);}
.ci-green{background:var(--g-l);color:var(--g);}
.ci-yellow{background:var(--y-l);color:var(--y);}
.ci-red{background:var(--r-l);color:var(--r);}
.ci-purple{background:#ede9fe;color:#7c3aed;}
.card-title{
  font-family:'Syne',sans-serif;
  font-size:13px;font-weight:700;color:var(--txt);flex:1;
}
.card-badge{font-size:10px;padding:2px 9px;border-radius:20px;font-weight:700;}
.badge-req{background:var(--a-l);color:var(--a);}
.badge-opt{background:var(--g-l);color:var(--g);}
.badge-ux{background:var(--y-l);color:var(--y);}
.card-body{padding:18px;}

/* Collapsible card */
.card-head.collapsible{cursor:pointer;user-select:none;}
.card-head.collapsible:hover{background:var(--surface3);}
.collapse-chevron{color:var(--muted);transition:transform var(--trans);}
.card.collapsed .collapse-chevron{transform:rotate(-90deg);}
.card.collapsed .card-body{display:none;}

/* ══════════ FORM ELEMENTS ══════════ */
.form-row{display:grid;gap:14px;margin-bottom:14px;}
.form-row.cols-2{grid-template-columns:1fr 1fr;}
.form-row.cols-3{grid-template-columns:1fr 1fr 1fr;}
.form-row.cols-4{grid-template-columns:1fr 1fr 1fr 1fr;}
.form-row.auto{grid-template-columns:repeat(auto-fit,minmax(180px,1fr));}

.field{display:flex;flex-direction:column;gap:5px;}
.field-label{
  font-size:10.5px;font-weight:700;letter-spacing:.5px;
  text-transform:uppercase;color:var(--muted);
  display:flex;align-items:center;gap:5px;
}
.req-star{color:var(--r);font-size:12px;}
.tip-btn{
  width:15px;height:15px;border-radius:50%;
  background:var(--surface-elevated);border:1px solid var(--border2);
  color:var(--muted);cursor:help;display:grid;place-items:center;
  font-size:9px;transition:all var(--trans);flex-shrink:0;
  font-style:normal;
}
.tip-btn:hover{background:var(--color-info-bg);border-color:var(--a);color:var(--a);}
/* tooltip popup */
.tip-btn{position:relative;}
.tip-popup{
  position:absolute;top:calc(100% + 8px);left:50%;transform:translateX(-50%);
  background:var(--txt);color:#fff;border-radius:9px;
  padding:9px 13px;font-size:11.5px;line-height:1.55;
  white-space:normal;max-width:min(300px,calc(100vw - 24px));min-width:160px;
  pointer-events:none;z-index:500;
  opacity:0;transform:translateX(-50%) translateY(5px);
  transition:opacity .18s,transform .18s;
  font-weight:500;font-family:'Epilogue',sans-serif;
  text-transform:none;letter-spacing:0;
  box-shadow:0 8px 30px rgba(0,0,0,.25);
}
.tip-popup::after{
  content:'';position:absolute;bottom:100%;left:50%;transform:translateX(-50%);
  border:5px solid transparent;border-bottom-color:var(--txt);
}
.tip-btn:hover .tip-popup,.tip-btn:focus .tip-popup{
  opacity:0;transform:translateX(-50%) translateY(5px);
}

.global-tip{
  position:fixed;
  z-index:1200;
  background:var(--txt);
  color:var(--surface);
  border-radius:9px;
  padding:9px 13px;
  font-size:11.5px;
  line-height:1.55;
  max-width:min(340px,calc(100vw - 20px));
  box-shadow:0 8px 30px rgba(0,0,0,.35);
  pointer-events:none;
  opacity:0;
  transform:translateY(6px);
  transition:opacity .16s,transform .16s;
}
.global-tip.visible{opacity:1;transform:translateY(0);}

@media (prefers-contrast: more), (forced-colors: active){
  .global-tip{
    border:2px solid currentColor;
    background:#000;
    color:#fff;
    box-shadow:none;
    opacity:1;
  }
}

@media(max-width:900px){
  .tip-popup{left:auto;right:0;transform:translateY(5px);}
  .tip-btn:hover .tip-popup,.tip-btn:focus .tip-popup{transform:translateY(0);}
  .tip-popup::after{left:auto;right:8px;transform:none;}
}

@media(max-width:900px){
  .tip-popup{left:auto;right:0;transform:translateY(5px);}
  .tip-btn:hover .tip-popup,.tip-btn:focus .tip-popup{transform:translateY(0);}
  .tip-popup::after{left:auto;right:8px;transform:none;}
}

.fc,.fs{
  background:var(--surface);border:1.5px solid var(--border);
  color:var(--txt);border-radius:var(--radius-sm);
  font-size:13.5px;font-family:'Epilogue',sans-serif;font-weight:500;
  padding:9px 12px;width:100%;
  transition:border-color var(--trans),box-shadow var(--trans),background var(--trans);
}
.fc:focus,.fs:focus{
  border-color:var(--a);box-shadow:0 0 0 3px rgba(37,99,235,.12);
  outline:none;background:#fff;
}
.fc.filled{border-color:var(--g);background:#fafffe;}
.fc.filled:focus{border-color:var(--g);box-shadow:0 0 0 3px rgba(5,150,105,.1);}
.fc::placeholder{color:var(--muted);font-weight:400;}
textarea.fc{resize:vertical;min-height:80px;line-height:1.6;}
.mono{font-family:'JetBrains Mono',monospace;font-size:12.5px;}
.field-hint{font-size:11.5px;color:var(--muted);line-height:1.5;display:flex;align-items:flex-start;gap:5px;}
.field-hint i{color:var(--a);flex-shrink:0;margin-top:1px;}
.fc.validation-error,.fs.validation-error{border-color:#dc2626;background:#fef2f2;}
.fc.validation-error:focus,.fs.validation-error:focus{box-shadow:0 0 0 3px rgba(220,38,38,.14);}
.field-validation-message{display:none;margin-top:6px;font-size:11.5px;color:#b91c1c;line-height:1.45;}
.field-validation-message.visible{display:block;}
.sum-alert-list{margin:0;padding-left:18px;}
.sum-alert-list li{margin-bottom:3px;}

/* ══════════ RADIO PILLS ══════════ */
.radio-group{display:flex;flex-wrap:wrap;gap:6px;}
.rpill input[type=radio]{display:none;}
.rpill label{
  background:var(--surface2);border:1.5px solid var(--border);
  border-radius:20px;padding:5px 14px;
  font-size:12.5px;font-weight:600;color:var(--muted);
  cursor:pointer;transition:all var(--trans);
  font-family:'Epilogue',sans-serif;
}
.rpill input:checked+label{
  background:var(--a);border-color:var(--a);color:#fff;
  box-shadow:0 4px 10px rgba(37,99,235,.25);
  transform:translateY(-1px);
}
.rpill label:hover{border-color:var(--a);color:var(--a);}

/* ══════════ TOGGLE SWITCH ══════════ */
.toggle-row{display:flex;align-items:center;gap:10px;padding:4px 0;}
.toggle-sw{position:relative;width:38px;height:22px;flex-shrink:0;}
.toggle-sw input{opacity:0;width:0;height:0;}
.toggle-track{
  position:absolute;inset:0;border-radius:11px;
  background:var(--border2);cursor:pointer;transition:all var(--trans);
}
.toggle-sw input:checked~.toggle-track{background:var(--a);}
.toggle-thumb{
  position:absolute;top:3px;left:3px;
  width:16px;height:16px;border-radius:50%;
  background:#fff;transition:transform var(--bounce);
  box-shadow:0 1px 4px rgba(0,0,0,.2);pointer-events:none;
}
.toggle-sw input:checked~.toggle-track .toggle-thumb{transform:translateX(16px);}
.toggle-label{font-size:13px;font-weight:600;color:var(--txt2);cursor:pointer;line-height:1.3;}

/* ══════════ DYNAMIC TABLE ══════════ */
.dt-wrap{overflow-x:auto;border-radius:var(--radius-sm);border:1px solid var(--border);}
.dt{width:100%;border-collapse:collapse;min-width:500px;}
.dt thead th{
  background:var(--surface2);
  font-size:10px;font-weight:800;text-transform:uppercase;letter-spacing:.5px;
  color:var(--label,var(--muted));padding:9px 10px;border-bottom:1px solid var(--border);
  white-space:nowrap;
}
.dt tbody tr{border-bottom:1px solid var(--border);transition:background var(--trans);}
.dt tbody tr:last-child{border-bottom:none;}
.dt tbody tr:hover{background:var(--a-l);}
.dt td{padding:6px 8px;vertical-align:middle;}
.dt input,.dt select,.dt textarea{
  background:var(--surface);border:1.5px solid var(--border);
  color:var(--txt);border-radius:6px;padding:5px 8px;
  font-size:12.5px;font-family:'Epilogue',sans-serif;font-weight:500;width:100%;
  transition:border var(--trans);
}
.dt input:focus,.dt select:focus{outline:none;border-color:var(--a);}
.row-num{font-size:11px;font-family:'JetBrains Mono',monospace;color:var(--muted);text-align:center;}
.drag-handle{color:var(--border2);cursor:grab;font-size:14px;display:block;text-align:center;}
.row-move{display:flex;flex-direction:column;gap:4px;align-items:center;justify-content:center;}
.row-actions{display:flex;align-items:center;justify-content:center;gap:6px;}
.btn-move{
  width:22px;height:22px;border-radius:6px;
  border:1px solid var(--border);
  background:var(--surface2);color:var(--muted);
  display:grid;place-items:center;
  cursor:pointer;font-size:11px;
  transition:all var(--trans);
}
.btn-move:hover{border-color:var(--a);color:var(--a);background:var(--a-l);}

/* ══════════ BUTTONS ══════════ */
.btn-add{
  display:inline-flex;align-items:center;gap:6px;
  padding:7px 14px;border:1.5px dashed var(--border2);
  border-radius:var(--radius-sm);font-size:12.5px;font-weight:700;
  color:var(--a);background:transparent;cursor:pointer;
  transition:all var(--trans);font-family:'Epilogue',sans-serif;
}
.btn-add:hover{border-color:var(--a);background:var(--a-l);transform:translateY(-1px);}
.btn-rm{
  background:none;border:none;color:var(--muted);cursor:pointer;
  padding:4px;border-radius:5px;transition:all var(--trans);font-size:14px;
}
.btn-rm:hover{color:var(--r);background:var(--r-l);}
.btn-primary{
  background:linear-gradient(135deg,var(--a),var(--a-d));
  color:#fff;border:none;border-radius:var(--radius-sm);
  padding:10px 22px;font-size:14px;font-weight:700;
  cursor:pointer;transition:all var(--trans);
  display:inline-flex;align-items:center;gap:7px;
  font-family:'Epilogue',sans-serif;
  box-shadow:0 4px 14px rgba(37,99,235,.3);
}
.btn-primary:hover{box-shadow:0 6px 20px rgba(37,99,235,.4);transform:translateY(-2px);}
.btn-secondary{
  background:var(--surface);color:var(--txt2);border:1.5px solid var(--border);
  border-radius:var(--radius-sm);padding:10px 18px;font-size:14px;font-weight:700;
  cursor:pointer;transition:all var(--trans);
  display:inline-flex;align-items:center;gap:7px;
  font-family:'Epilogue',sans-serif;
}
.btn-secondary:hover{border-color:var(--a);color:var(--a);transform:translateY(-1px);}
.btn-danger-sm{
  background:var(--r-l);color:var(--r);border:1px solid rgba(220,38,38,.2);
  border-radius:6px;padding:4px 10px;font-size:12px;font-weight:700;cursor:pointer;
  transition:all var(--trans);font-family:'Epilogue',sans-serif;
}
.btn-danger-sm:hover{background:#fca5a5;transform:scale(1.02);}

/* Nav arrows */
.nav-actions{display:flex;justify-content:space-between;align-items:center;margin-top:24px;padding-top:20px;border-top:1px solid var(--border);}

/* ══════════ INFO ALERTS ══════════ */
.info-alert,.warn-alert{
  border-radius:var(--radius-sm);padding:11px 14px;
  font-size:12.5px;color:var(--txt2);
  display:flex;gap:9px;line-height:1.55;margin-bottom:14px;
}
.info-alert{background:var(--a-l);border:1px solid rgba(37,99,235,.15);}
.warn-alert{background:var(--y-l);border:1px solid rgba(217,119,6,.2);color:#78350f;}
.info-alert i,.warn-alert i{flex-shrink:0;font-size:15px;margin-top:1px;}
.info-alert i{color:var(--a);}
.warn-alert i{color:var(--y);}

/* ══════════ HF ZONES ══════════ */
.hf-zone{border:1.5px solid var(--border);border-radius:var(--radius);margin-bottom:14px;overflow:visible;transition:all var(--trans);}
.hf-zone:hover{border-color:var(--border2);box-shadow:var(--shadow);}
.hf-zone-head{padding:12px 16px;display:flex;align-items:center;gap:9px;font-size:12px;font-weight:800;cursor:pointer;}
.hf-rh{background:linear-gradient(135deg,#d1fae5,#a7f3d0)!important;color:#065f46;}
.hf-ph{background:linear-gradient(135deg,#dbeafe,#bfdbfe)!important;color:#1e3a8a;}
.hf-pf{background:linear-gradient(135deg,#fef3c7,#fde68a)!important;color:#78350f;}
.hf-rf{background:linear-gradient(135deg,#fee2e2,#fecaca)!important;color:#7f1d1d;}
.hf-body{padding:16px;border-top:1px solid var(--border);}
.hf-zone.hf-collapsed .hf-body{display:none;}
.hf-chevron{margin-left:auto;font-size:12px;transition:transform var(--trans);}
.hf-zone.hf-collapsed .hf-chevron{transform:rotate(-90deg);}

/* ══════════ SUBREPORT CARDS ══════════ */
.sr-card{border:1.5px solid var(--border);border-radius:var(--radius);margin-bottom:12px;overflow:visible;transition:all var(--trans);}
.sr-card:hover{border-color:var(--border2);box-shadow:var(--shadow);}
.sr-head{padding:11px 16px;background:var(--surface2);border-bottom:1px solid var(--border);display:flex;align-items:center;gap:10px;}
.sr-pill{font-size:10px;font-weight:700;padding:2px 8px;border-radius:20px;}
.sr-inline{background:var(--a-l);color:var(--a);}
.sr-ondemand{background:var(--g-l);color:var(--g);}
.sr-tabs{display:flex;border-bottom:1px solid var(--border);background:var(--surface2);overflow-x:auto;}
.sr-tab{
  padding:9px 14px;font-size:12px;font-weight:700;color:var(--muted);
  border:none;background:none;cursor:pointer;
  border-bottom:2px solid transparent;margin-bottom:-1px;
  transition:all var(--trans);white-space:nowrap;
  font-family:'Epilogue',sans-serif;
}
.sr-tab.active{color:var(--a);border-bottom-color:var(--a);}
.sr-pane{display:none;padding:16px;}
.sr-pane.active{display:block;animation:tabPaneFade .25s ease;}

/* ══════════ CONDITION BUILDER ══════════ */
.cond-group{background:var(--surface);border:1.5px solid var(--border);border-radius:var(--radius-sm);margin-bottom:10px;overflow:visible;transition:all var(--trans);}
.cond-group-bar{background:var(--surface2);padding:9px 14px;display:flex;align-items:center;gap:8px;border-bottom:1px solid var(--border);flex-wrap:wrap;}
.logic-sel{background:var(--surface);border:1.5px solid var(--border);color:var(--a);border-radius:6px;padding:3px 8px;font-size:12px;font-weight:700;cursor:pointer;font-family:'Epilogue',sans-serif;}

/* ══════════ EMPTY STATE ══════════ */
.es-preview{background:var(--surface2);border:1.5px dashed var(--border2);border-radius:var(--radius);padding:28px;text-align:center;transition:all var(--trans);}
.es-icon{font-size:40px;color:var(--muted);margin-bottom:10px;display:block;animation:dotPulse 3s ease-in-out infinite;}
.es-title{font-size:15px;font-weight:700;color:var(--txt2);margin-bottom:5px;font-family:'Syne',sans-serif;}
.es-sub{font-size:13px;color:var(--muted);}

/* ══════════ FORMAT CARDS ══════════ */
.fmt-card{border:1.5px solid var(--border);border-radius:var(--radius-sm);margin-bottom:10px;overflow:visible;transition:all var(--trans);}
.fmt-card:hover{border-color:var(--border2);}
.fmt-card:has(.fmt-cb:checked){border-color:var(--a);box-shadow:0 0 0 3px rgba(37,99,235,.08);}
.fmt-head{padding:12px 16px;display:flex;align-items:center;gap:10px;background:var(--surface2);cursor:pointer;transition:all var(--trans);}
.fmt-head:hover{background:var(--surface3);}
.fmt-ico{width:30px;height:30px;border-radius:7px;display:grid;place-items:center;font-size:14px;flex-shrink:0;}
.fmt-pdf{background:var(--r-l);color:var(--r);}
.fmt-xls{background:var(--g-l);color:var(--g);}
.fmt-doc{background:var(--a-l);color:var(--a);}
.fmt-csv{background:var(--y-l);color:var(--y);}
.fmt-name{font-size:13px;font-weight:700;flex:1;color:var(--txt);font-family:'Syne',sans-serif;}
.fmt-chevron{color:var(--muted);font-size:12px;transition:transform var(--trans);}
.fmt-body{display:none;padding:16px;border-top:1px solid var(--border);}
.fmt-body.open{display:block;animation:tabPaneFade .25s ease;}

/* ══════════ TOKEN CHIPS ══════════ */
.token-chips{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px;}
.tchip{
  font-size:11px;font-family:'JetBrains Mono',monospace;
  background:var(--a-l);border:1px solid rgba(37,99,235,.2);
  color:var(--a);border-radius:5px;padding:3px 9px;
  cursor:pointer;transition:all var(--trans);
}
.tchip:hover{background:var(--a);color:#fff;transform:translateY(-1px);}
.tchip.g{background:var(--g-l);border-color:rgba(5,150,105,.2);color:var(--g);}
.tchip.g:hover{background:var(--g);color:#fff;}
.tchip.y{background:var(--y-l);border-color:rgba(217,119,6,.2);color:var(--y);}
.tchip.y:hover{background:var(--y);color:#fff;}

/* ══════════ FOOTER BAR ══════════ */
.footer-bar{
  position:fixed;bottom:0;
  left:var(--sidebar-w);right:0;
  background:rgba(255,255,255,.92);
  backdrop-filter:blur(12px);
  border-top:1px solid var(--border);
  padding:10px 28px;
  display:flex;justify-content:space-between;align-items:center;
  z-index:130;
  transition:left var(--trans),right var(--trans);
  box-shadow:0 -4px 20px rgba(15,23,42,.06);
}
.body-sidebar-collapsed .footer-bar{left:var(--sidebar-collapsed);}
.footer-info{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--muted);display:flex;align-items:center;gap:10px;}
.footer-step{background:var(--a-l);color:var(--a);padding:2px 8px;border-radius:20px;font-weight:700;}
.footer-actions{display:flex;gap:8px;}

/* ══════════ TOAST ══════════ */
.toast-container{position:fixed;bottom:80px;right:20px;z-index:999;display:flex;flex-direction:column;gap:8px;}
.toast{
  background:var(--surface-overlay);color:#fff;border-radius:10px;
  padding:11px 16px;font-size:13px;font-weight:600;
  display:flex;align-items:center;gap:9px;
  box-shadow:var(--shadow-lg);min-width:220px;
  animation:toastIn .3s var(--bounce) both;
  font-family:'Epilogue',sans-serif;
}
.toast.success{background:var(--color-success-bg);color:var(--g);}
.toast.warning{background:var(--color-warning-bg);color:var(--y);}
.toast.removing{animation:toastOut .25s ease forwards;}

/* ══════════ MOBILE OVERLAY ══════════ */
.mobile-overlay{
  display:none;position:fixed;inset:0;
  background:rgba(15,23,42,.5);z-index:145;
  backdrop-filter:blur(4px);
}
.mobile-menu-btn{
  display:none;width:36px;height:36px;border-radius:var(--radius-sm);
  background:none;border:1.5px solid var(--border);
  color:var(--txt);cursor:pointer;place-items:center;font-size:16px;
  margin-right:4px;flex-shrink:0;
}

/* ══════════ RESPONSIVE ══════════ */
@media(max-width:900px){
  :root{--sidebar-w:260px;}
  .sidebar{transform:translateX(-100%);width:var(--sidebar-w)!important;}
  .sidebar.mobile-open{transform:translateX(0);}
  .main{margin-left:0!important;}
  .footer-bar{left:0!important;}
  .topbar-brand{min-width:auto;}
  .mobile-menu-btn{display:grid;}
  .mobile-overlay.open{display:block;}
  .global-progress{max-width:200px;}
  .topbar-center .progress-label{display:none;}
  .tab-content{padding:20px 16px 100px;}
  .form-row.cols-3,.form-row.cols-4{grid-template-columns:1fr 1fr;}
  .form-row.cols-2{grid-template-columns:1fr;}
  .summary-panel{
    top:auto;
    inset:0;
    width:100vw;
    max-width:none;
    border-left:none;
    border-top:1px solid var(--border);
    border-radius:16px 16px 0 0;
    box-shadow:0 -12px 40px rgba(15,23,42,.26);
    transform:translateY(100%);
  }
  .body-summary-open .summary-panel,
  .body-summary-closing .summary-panel{z-index:300;}
  .body-summary-open .summary-panel{transform:translateY(0);}
  .body-summary-closing .summary-panel{transform:translateY(100%);}
  .sum-panel-head{
    padding:16px;
    gap:8px;
  }
  .sum-panel-head::before{
    content:'';
    position:absolute;
    top:8px;
    left:50%;
    transform:translateX(-50%);
    width:42px;
    height:4px;
    border-radius:999px;
    background:var(--border2);
  }
  .sum-panel-title{font-size:15px;}
  .quick-actions{padding:0 16px;}
  .tab-content{padding-top:12px;}
}
@media(max-width:600px){
  .form-row.cols-2,.form-row.cols-3,.form-row.cols-4{grid-template-columns:1fr;}
  .page-header h1{font-size:20px;}
  .tb-btn span{display:none;}
  .topbar-right .tb-btn:not(.primary){display:none;}
  .dt{min-width:400px;}
}

/* ══════════ SCROLLBAR ══════════ */
::-webkit-scrollbar{width:6px;height:6px;}
::-webkit-scrollbar-track{background:transparent;}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:3px;}
::-webkit-scrollbar-thumb:hover{background:var(--muted);}

/* ══════════ CHECKBOX ══════════ */
input[type=checkbox]{accent-color:var(--a);width:15px;height:15px;cursor:pointer;}
input[type=color]{border-radius:6px;border:1.5px solid var(--border);cursor:pointer;height:34px;}
select.fs option{background:#fff;}
body.theme-dark .topbar,
body.theme-dark .footer-bar{background:rgba(17,24,39,.9);}
body.theme-dark .global-tip{background:var(--surface-overlay);color:#e2e8f0;}
